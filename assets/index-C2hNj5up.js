var Ct=Object.defineProperty;var kt=(Z,t,r)=>t in Z?Ct(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):Z[t]=r;var St=(Z,t,r)=>kt(Z,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))n(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const p of g.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function n(d){if(d.ep)return;d.ep=!0;const g=r(d);fetch(d.href,g)}})();class Dt{constructor(t){this.canvas=t,this.initWebGL()}initWebGL(){if(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.gl=this.canvas.getContext("webgl2"),!this.gl)throw new Error("WebGL 2.0 is not supported in your browser.");this.gl.clearColor(0,0,0,1),this.clear(),this.gl.enable(this.gl.BLEND),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}resizeCanvas(){const t=window.devicePixelRatio||1,r=this.canvas.clientWidth,n=this.canvas.clientHeight;(this.canvas.width!==r*t||this.canvas.height!==n*t)&&(this.canvas.width=r*t,this.canvas.height=n*t,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}createProjectionMatrix(t,r,n){const d=this.canvas.width/this.canvas.height,g=1/n;return new Float32Array([g/d,0,0,0,0,g,0,0,0,0,1,0,-t*g/d,-r*g,0,1])}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}class Rt{constructor(t){this.gl=t,this.program=null,this.locations={}}createShader(t,r){const n=this.gl.createShader(t);return this.gl.shaderSource(n,r),this.gl.compileShader(n),n}createProgram(t,r){const n=this.createShader(this.gl.VERTEX_SHADER,t),d=this.createShader(this.gl.FRAGMENT_SHADER,r),g=this.gl.createProgram();return this.gl.attachShader(g,n),this.gl.attachShader(g,d),this.gl.linkProgram(g),this.gl.deleteShader(n),this.gl.deleteShader(d),g}}class It extends Rt{constructor(t){super(t),this.numCircles=0,this.offsets=null,this.sizes=null,this.colors=null,this.titles=null,this.ids=null,this.vao=null,this.buffers={position:null,offset:null,size:null,color:null},this.initShaders()}initShaders(){const t=`#version 300 es
      in vec2 a_position;    
      in vec2 a_offset;     
      in float a_size;
      in vec4 a_color;       
      uniform mat4 u_projection;   
      uniform float cameraDistance;
      out vec2 v_point;    
      out vec4 v_color;     
      void main() {
        vec2 scaledPosition = a_position * (a_size  + cameraDistance) + a_offset;
        gl_Position = u_projection * vec4(scaledPosition, 0.0, 1.0);
        v_point = a_position;
        v_color = a_color;
      }
    `,r=`#version 300 es
      precision highp float;
      in vec2 v_point;         
      in vec4 v_color; 
      out vec4 fragColor;
      
      void main() {
        float dist = length(v_point); 
        if (dist > 1.0) discard;     
        
        // Mix the color with white to make it more pastel
        vec3 pastelColor = mix(v_color.rgb, vec3(1.0), 0.3); 
        fragColor = vec4(pastelColor, v_color.a);
      }
    `;this.program=this.createProgram(t,r),this.locations={position:this.gl.getAttribLocation(this.program,"a_position"),offset:this.gl.getAttribLocation(this.program,"a_offset"),size:this.gl.getAttribLocation(this.program,"a_size"),color:this.gl.getAttribLocation(this.program,"a_color"),projection:this.gl.getUniformLocation(this.program,"u_projection"),cameraDistance:this.gl.getUniformLocation(this.program,"cameraDistance")}}setData(t){this.numCircles=t.numItems,this.offsets=t.offsets,this.sizes=t.sizes,this.colors=t.colors,this.titles=t.titles,this.ids=t.ids,this.initBuffers()}initBuffers(){const t=this.gl;this.clean(),this.vao=t.createVertexArray(),t.bindVertexArray(this.vao);const r=new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]);this.buffers.position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.position),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.enableVertexAttribArray(this.locations.position),t.vertexAttribPointer(this.locations.position,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.position,0),this.buffers.offset=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.offset),t.bufferData(t.ARRAY_BUFFER,this.offsets,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.offset),t.vertexAttribPointer(this.locations.offset,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.offset,1),this.buffers.size=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.size),t.bufferData(t.ARRAY_BUFFER,this.sizes,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.size),t.vertexAttribPointer(this.locations.size,1,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.size,1),this.buffers.color=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.color),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.color),t.vertexAttribPointer(this.locations.color,4,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.color,1),t.bindVertexArray(null)}draw(t,r){const n=this.gl;n.useProgram(this.program),n.bindVertexArray(this.vao),n.uniformMatrix4fv(this.locations.projection,!1,t),n.uniform1f(this.locations.cameraDistance,r*6e-4),n.drawArraysInstanced(n.TRIANGLES,0,6,this.numCircles)}clean(){const t=this.gl;this.vao&&(t.deleteVertexArray(this.vao),this.vao=null),this.buffers.position&&(t.deleteBuffer(this.buffers.position),this.buffers.position=null),this.buffers.offset&&(t.deleteBuffer(this.buffers.offset),this.buffers.offset=null),this.buffers.size&&(t.deleteBuffer(this.buffers.size),this.buffers.size=null),this.buffers.color&&(t.deleteBuffer(this.buffers.color),this.buffers.color=null)}}class zt extends Rt{constructor(t){super(t),this.fontInfo=null,this.characterCount=0,this.positions=null,this.charSizes=null,this.texturePositions=null,this.vao=null,this.texture=null,this.buffers={point:null,position:null,charSize:null,texturePosition:null},this.initShaders()}initShaders(){const t=`#version 300 es
      precision highp float;
      
      uniform mat4 modelViewProjection;
      uniform vec4 color;
      uniform vec2 viewportSize;
  
      in vec3 position;
      in vec2 point;
      in vec2 charSize;
      in vec4 texturePosition;
  
      out vec2 vPoint;
      out vec4 vColor;
  
      void main() {
        
        vec3 pos = position + vec3(vec2(point) * charSize.xy, 0.0);
        gl_Position = modelViewProjection * vec4(pos, 1.0);
        vPoint = texturePosition.xy + point * texturePosition.zw;
        vColor = color;
      }`,r=`#version 300 es
      precision highp float;
      
      uniform sampler2D msdf;
      uniform float bias;
  
      in vec2 vPoint;
      in vec4 vColor;
  
      out vec4 fragColor;
  
      float median(float r, float g, float b) {
        return max(min(r, g), min(max(r, g), b));
      }
  
      void main() {

        
        if (vColor.a <= 0.0) {
          discard;
          return;
        }
        
        vec3 saple = texture(msdf, vPoint).rgb;
        float sigDist = median(saple.r, saple.g, saple.b) - bias;

        float alpha = clamp(sigDist / fwidth(sigDist) + bias, 0.0, 1.0);

        fragColor = vec4(vColor.rgb, vColor.a * alpha);
        
        if (fragColor.a < 0.01) discard;
      }`;if(this.program=this.createProgram(t,r),!this.program){console.error("Failed to create shader program for text renderer");return}this.locations={position:this.gl.getAttribLocation(this.program,"position"),point:this.gl.getAttribLocation(this.program,"point"),charSize:this.gl.getAttribLocation(this.program,"charSize"),texturePosition:this.gl.getAttribLocation(this.program,"texturePosition"),modelViewProjection:this.gl.getUniformLocation(this.program,"modelViewProjection"),color:this.gl.getUniformLocation(this.program,"color"),bias:this.gl.getUniformLocation(this.program,"bias"),msdf:this.gl.getUniformLocation(this.program,"msdf")}}initBuffers(){const t=this.gl;this.clean(),this.vao=t.createVertexArray(),t.bindVertexArray(this.vao);const r=new Float32Array([0,0,1,0,1,1,1,1,0,0,0,1]);this.buffers.point=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.point),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.enableVertexAttribArray(this.locations.point),t.vertexAttribPointer(this.locations.point,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.point,0),this.buffers.position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.position),t.bufferData(t.ARRAY_BUFFER,this.positions,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.position),t.vertexAttribPointer(this.locations.position,3,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.position,1),this.buffers.charSize=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.charSize),t.bufferData(t.ARRAY_BUFFER,this.charSizes,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.charSize),t.vertexAttribPointer(this.locations.charSize,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.charSize,1),this.buffers.texturePosition=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.texturePosition),t.bufferData(t.ARRAY_BUFFER,this.texturePositions,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.texturePosition),t.vertexAttribPointer(this.locations.texturePosition,4,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.texturePosition,1),t.bindVertexArray(null)}async loadFont(){try{const r=await(await fetch("/Map-of-Wiki/fonts/Roboto.json",{mode:"cors"})).json();return this.fontInfo=r,this.alphabet=new Map,r.chars.forEach(n=>{this.alphabet.set(String.fromCharCode(n.id),n)}),new Promise((n,d)=>{const g=new Image;g.crossOrigin="Anonymous",g.onload=()=>{const p=this.gl;this.texture&&(p.deleteTexture(this.texture),this.texture=null),this.texture=p.createTexture(),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!0),p.bindTexture(p.TEXTURE_2D,this.texture),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,g),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.bindTexture(p.TEXTURE_2D,null),this.sdfTextureWidth=g.width,this.sdfTextureHeight=g.height,n()},g.onerror=()=>{d(new Error("Failed to load font texture"))},g.src="/Map-of-Wiki/fonts/Roboto0.png"})}catch(t){throw console.error("Failed to load font:",t),t}}allocateBuffers(t){this.positions=new Float32Array(t*3),this.charSizes=new Float32Array(t*2),this.texturePositions=new Float32Array(t*4)}batchAddText(t){let r=0;for(const n of t)n.text&&(r+=n.text.length);this.characterCount=0,this.allocateBuffers(r);for(const n of t)this.addText(n);this.initBuffers()}addText(t){let{text:r,x:n=0,y:d=0,z:g=0}=t,p=0,B=t.fontSize;if(t.limit!==void 0){let b=0;for(let D of r){const U=this.alphabet.get(D)||this.alphabet.get("?");b+=U.xadvance}B=t.limit*this.fontInfo.info.size/b}const j=B/this.fontInfo.info.size;if(t.cx!==void 0){let b=0;for(const D of r){const U=this.alphabet.get(D)||this.alphabet.get("_");b+=U.xadvance}p-=b*t.cx*j}t.cy!==void 0&&(d+=B*t.cy);for(let b=0;b<r.length;b++){const D=this.characterCount+b,U=r[b],Y=this.alphabet.get(U)||this.alphabet.get("_"),q=D*3;this.positions[q]=n+p,this.positions[q+1]=d-Y.yoffset*j,this.positions[q+2]=g;const st=D*2;this.charSizes[st]=B*Y.width/42,this.charSizes[st+1]=-B*Y.height/42;const at=D*4;this.texturePositions[at]=Y.x/this.sdfTextureWidth,this.texturePositions[at+1]=1-Y.y/this.sdfTextureHeight,this.texturePositions[at+2]=Y.width/this.sdfTextureWidth,this.texturePositions[at+3]=-Y.height/this.sdfTextureHeight,p+=Y.xadvance*j}this.characterCount+=r.length}draw(t){const r=this.gl;r.useProgram(this.program),r.bindVertexArray(this.vao),r.uniformMatrix4fv(this.locations.modelViewProjection,!1,t),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this.locations.msdf,0),r.uniform4f(this.locations.color,1,1,1,1),r.uniform1f(this.locations.bias,.5),r.drawArraysInstanced(r.TRIANGLES,0,6,this.characterCount),r.bindVertexArray(null)}clean(){const t=this.gl;this.vao&&(t.deleteVertexArray(this.vao),this.vao=null),this.buffers.point&&(t.deleteBuffer(this.buffers.point),this.buffers.point=null),this.buffers.position&&(t.deleteBuffer(this.buffers.position),this.buffers.position=null),this.buffers.charSize&&(t.deleteBuffer(this.buffers.charSize),this.buffers.charSize=null),this.buffers.texturePosition&&(t.deleteBuffer(this.buffers.texturePosition),this.buffers.texturePosition=null)}}function Tt(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}var _t={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Ft=_t.exports,At;function Pt(){return At||(At=1,function(Z,t){((r,n)=>{Z.exports=n()})(Ft,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},d,g=!n.document&&!!n.postMessage,p=n.IS_PAPA_WORKER||!1,B={},j=0,b={};function D(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(i){var o=gt(i);o.chunkSize=parseInt(o.chunkSize),i.step||i.chunk||(o.chunkSize=null),this._handle=new at(o),(this._handle.streamer=this)._config=o}).call(this,e),this.parseChunk=function(i,o){var m=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<m){let P=this._config.newline;P||(_=this._config.quoteChar||'"',P=this._handle.guessLineEndings(i,_)),i=[...i.split(P).slice(m)].join(P)}this.isFirstChunk&&H(this._config.beforeFirstChunk)&&(_=this._config.beforeFirstChunk(i))!==void 0&&(i=_),this.isFirstChunk=!1,this._halted=!1;var m=this._partialLine+i,_=(this._partialLine="",this._handle.parse(m,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(i=_.meta.cursor,m=(this._finished||(this._partialLine=m.substring(i-this._baseIndex),this._baseIndex=i),_&&_.data&&(this._rowCount+=_.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),p)n.postMessage({results:_,workerId:b.WORKER_ID,finished:m});else if(H(this._config.chunk)&&!o){if(this._config.chunk(_,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=_=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(_.data),this._completeResults.errors=this._completeResults.errors.concat(_.errors),this._completeResults.meta=_.meta),this._completed||!m||!H(this._config.complete)||_&&_.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),m||_&&_.meta.paused||this._nextChunk(),_}this._halted=!0},this._sendError=function(i){H(this._config.error)?this._config.error(i):p&&this._config.error&&n.postMessage({workerId:b.WORKER_ID,error:i,finished:!1})}}function U(e){var i;(e=e||{}).chunkSize||(e.chunkSize=b.RemoteChunkSize),D.call(this,e),this._nextChunk=g?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(o){this._input=o,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(i=new XMLHttpRequest,this._config.withCredentials&&(i.withCredentials=this._config.withCredentials),g||(i.onload=ot(this._chunkLoaded,this),i.onerror=ot(this._chunkError,this)),i.open(this._config.downloadRequestBody?"POST":"GET",this._input,!g),this._config.downloadRequestHeaders){var o,m=this._config.downloadRequestHeaders;for(o in m)i.setRequestHeader(o,m[o])}var _;this._config.chunkSize&&(_=this._start+this._config.chunkSize-1,i.setRequestHeader("Range","bytes="+this._start+"-"+_));try{i.send(this._config.downloadRequestBody)}catch(P){this._chunkError(P.message)}g&&i.status===0&&this._chunkError()}},this._chunkLoaded=function(){i.readyState===4&&(i.status<200||400<=i.status?this._chunkError():(this._start+=this._config.chunkSize||i.responseText.length,this._finished=!this._config.chunkSize||this._start>=(o=>(o=o.getResponseHeader("Content-Range"))!==null?parseInt(o.substring(o.lastIndexOf("/")+1)):-1)(i),this.parseChunk(i.responseText)))},this._chunkError=function(o){o=i.statusText||o,this._sendError(new Error(o))}}function Y(e){(e=e||{}).chunkSize||(e.chunkSize=b.LocalChunkSize),D.call(this,e);var i,o,m=typeof FileReader<"u";this.stream=function(_){this._input=_,o=_.slice||_.webkitSlice||_.mozSlice,m?((i=new FileReader).onload=ot(this._chunkLoaded,this),i.onerror=ot(this._chunkError,this)):i=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var _=this._input,P=(this._config.chunkSize&&(P=Math.min(this._start+this._config.chunkSize,this._input.size),_=o.call(_,this._start,P)),i.readAsText(_,this._config.encoding));m||this._chunkLoaded({target:{result:P}})},this._chunkLoaded=function(_){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(_.target.result)},this._chunkError=function(){this._sendError(i.error)}}function q(e){var i;D.call(this,e=e||{}),this.stream=function(o){return i=o,this._nextChunk()},this._nextChunk=function(){var o,m;if(!this._finished)return o=this._config.chunkSize,i=o?(m=i.substring(0,o),i.substring(o)):(m=i,""),this._finished=!i,this.parseChunk(m)}}function st(e){D.call(this,e=e||{});var i=[],o=!0,m=!1;this.pause=function(){D.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){D.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(_){this._input=_,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&i.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),i.length?this.parseChunk(i.shift()):o=!0},this._streamData=ot(function(_){try{i.push(typeof _=="string"?_:_.toString(this._config.encoding)),o&&(o=!1,this._checkIsFinished(),this.parseChunk(i.shift()))}catch(P){this._streamError(P)}},this),this._streamError=ot(function(_){this._streamCleanUp(),this._sendError(_)},this),this._streamEnd=ot(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=ot(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function at(e){var i,o,m,_,P=Math.pow(2,53),Q=-P,it=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,et=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,M=this,X=0,L=0,N=!1,I=!1,W=[],y={data:[],errors:[],meta:{}};function a(f){return e.skipEmptyLines==="greedy"?f.join("").trim()==="":f.length===1&&f[0].length===0}function s(){if(y&&m&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+b.DefaultDelimiter+"'"),m=!1),e.skipEmptyLines&&(y.data=y.data.filter(function(v){return!a(v)})),l()){let v=function(R,w){H(e.transformHeader)&&(R=e.transformHeader(R,w)),W.push(R)};var u=v;if(y)if(Array.isArray(y.data[0])){for(var f=0;l()&&f<y.data.length;f++)y.data[f].forEach(v);y.data.splice(0,1)}else y.data.forEach(v)}function c(v,R){for(var w=e.header?{}:[],F=0;F<v.length;F++){var S=F,C=v[F],C=((z,A)=>(k=>(e.dynamicTypingFunction&&e.dynamicTyping[k]===void 0&&(e.dynamicTyping[k]=e.dynamicTypingFunction(k)),(e.dynamicTyping[k]||e.dynamicTyping)===!0))(z)?A==="true"||A==="TRUE"||A!=="false"&&A!=="FALSE"&&((k=>{if(it.test(k)&&(k=parseFloat(k),Q<k&&k<P))return 1})(A)?parseFloat(A):et.test(A)?new Date(A):A===""?null:A):A)(S=e.header?F>=W.length?"__parsed_extra":W[F]:S,C=e.transform?e.transform(C,S):C);S==="__parsed_extra"?(w[S]=w[S]||[],w[S].push(C)):w[S]=C}return e.header&&(F>W.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+W.length+" fields but parsed "+F,L+R):F<W.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+W.length+" fields but parsed "+F,L+R)),w}var h;y&&(e.header||e.dynamicTyping||e.transform)&&(h=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(c),h=y.data.length):y.data=c(y.data,0),e.header&&y.meta&&(y.meta.fields=W),L+=h)}function l(){return e.header&&W.length===0}function x(f,c,h,u){f={type:f,code:c,message:h},u!==void 0&&(f.row=u),y.errors.push(f)}H(e.step)&&(_=e.step,e.step=function(f){y=f,l()?s():(s(),y.data.length!==0&&(X+=f.data.length,e.preview&&X>e.preview?o.abort():(y.data=y.data[0],_(y,M))))}),this.parse=function(f,c,h){var u=e.quoteChar||'"',u=(e.newline||(e.newline=this.guessLineEndings(f,u)),m=!1,e.delimiter?H(e.delimiter)&&(e.delimiter=e.delimiter(f),y.meta.delimiter=e.delimiter):((u=((v,R,w,F,S)=>{var C,z,A,k;S=S||[",","	","|",";",b.RECORD_SEP,b.UNIT_SEP];for(var rt=0;rt<S.length;rt++){for(var J,tt=S[rt],T=0,G=0,E=0,K=(A=void 0,new dt({comments:F,delimiter:tt,newline:R,preview:10}).parse(v)),$=0;$<K.data.length;$++)w&&a(K.data[$])?E++:(J=K.data[$].length,G+=J,A===void 0?A=J:0<J&&(T+=Math.abs(J-A),A=J));0<K.data.length&&(G/=K.data.length-E),(z===void 0||T<=z)&&(k===void 0||k<G)&&1.99<G&&(z=T,C=tt,k=G)}return{successful:!!(e.delimiter=C),bestDelimiter:C}})(f,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=u.bestDelimiter:(m=!0,e.delimiter=b.DefaultDelimiter),y.meta.delimiter=e.delimiter),gt(e));return e.preview&&e.header&&u.preview++,i=f,o=new dt(u),y=o.parse(i,c,h),s(),N?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return N},this.pause=function(){N=!0,o.abort(),i=H(e.chunk)?"":i.substring(o.getCharIndex())},this.resume=function(){M.streamer._halted?(N=!1,M.streamer.parseChunk(i,!0)):setTimeout(M.resume,3)},this.aborted=function(){return I},this.abort=function(){I=!0,o.abort(),y.meta.aborted=!0,H(e.complete)&&e.complete(y),i=""},this.guessLineEndings=function(v,u){v=v.substring(0,1048576);var u=new RegExp(nt(u)+"([^]*?)"+nt(u),"gm"),h=(v=v.replace(u,"")).split("\r"),u=v.split(`
`),v=1<u.length&&u[0].length<h[0].length;if(h.length===1||v)return`
`;for(var R=0,w=0;w<h.length;w++)h[w][0]===`
`&&R++;return R>=h.length/2?`\r
`:"\r"}}function nt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function dt(e){var i=(e=e||{}).delimiter,o=e.newline,m=e.comments,_=e.step,P=e.preview,Q=e.fastMode,it=null,et=!1,M=e.quoteChar==null?'"':e.quoteChar,X=M;if(e.escapeChar!==void 0&&(X=e.escapeChar),(typeof i!="string"||-1<b.BAD_DELIMITERS.indexOf(i))&&(i=","),m===i)throw new Error("Comment character same as delimiter");m===!0?m="#":(typeof m!="string"||-1<b.BAD_DELIMITERS.indexOf(m))&&(m=!1),o!==`
`&&o!=="\r"&&o!==`\r
`&&(o=`
`);var L=0,N=!1;this.parse=function(I,W,y){if(typeof I!="string")throw new Error("Input must be a string");var a=I.length,s=i.length,l=o.length,x=m.length,f=H(_),c=[],h=[],u=[],v=L=0;if(!I)return T();if(Q||Q!==!1&&I.indexOf(M)===-1){for(var R=I.split(o),w=0;w<R.length;w++){if(u=R[w],L+=u.length,w!==R.length-1)L+=o.length;else if(y)return T();if(!m||u.substring(0,x)!==m){if(f){if(c=[],k(u.split(i)),G(),N)return T()}else k(u.split(i));if(P&&P<=w)return c=c.slice(0,P),T(!0)}}return T()}for(var F=I.indexOf(i,L),S=I.indexOf(o,L),C=new RegExp(nt(X)+nt(M),"g"),z=I.indexOf(M,L);;)if(I[L]===M)for(z=L,L++;;){if((z=I.indexOf(M,z+1))===-1)return y||h.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:c.length,index:L}),J();if(z===a-1)return J(I.substring(L,z).replace(C,M));if(M===X&&I[z+1]===X)z++;else if(M===X||z===0||I[z-1]!==X){F!==-1&&F<z+1&&(F=I.indexOf(i,z+1));var A=rt((S=S!==-1&&S<z+1?I.indexOf(o,z+1):S)===-1?F:Math.min(F,S));if(I.substr(z+1+A,s)===i){u.push(I.substring(L,z).replace(C,M)),I[L=z+1+A+s]!==M&&(z=I.indexOf(M,L)),F=I.indexOf(i,L),S=I.indexOf(o,L);break}if(A=rt(S),I.substring(z+1+A,z+1+A+l)===o){if(u.push(I.substring(L,z).replace(C,M)),tt(z+1+A+l),F=I.indexOf(i,L),z=I.indexOf(M,L),f&&(G(),N))return T();if(P&&c.length>=P)return T(!0);break}h.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:c.length,index:L}),z++}}else if(m&&u.length===0&&I.substring(L,L+x)===m){if(S===-1)return T();L=S+l,S=I.indexOf(o,L),F=I.indexOf(i,L)}else if(F!==-1&&(F<S||S===-1))u.push(I.substring(L,F)),L=F+s,F=I.indexOf(i,L);else{if(S===-1)break;if(u.push(I.substring(L,S)),tt(S+l),f&&(G(),N))return T();if(P&&c.length>=P)return T(!0)}return J();function k(E){c.push(E),v=L}function rt(E){var K=0;return K=E!==-1&&(E=I.substring(z+1,E))&&E.trim()===""?E.length:K}function J(E){return y||(E===void 0&&(E=I.substring(L)),u.push(E),L=a,k(u),f&&G()),T()}function tt(E){L=E,k(u),u=[],S=I.indexOf(o,L)}function T(E){if(e.header&&!W&&c.length&&!et){var K=c[0],$=Object.create(null),lt=new Set(K);let ct=!1;for(let ht=0;ht<K.length;ht++){let O=K[ht];if($[O=H(e.transformHeader)?e.transformHeader(O,ht):O]){let V,pt=$[O];for(;V=O+"_"+pt,pt++,lt.has(V););lt.add(V),K[ht]=V,$[O]++,ct=!0,(it=it===null?{}:it)[V]=O}else $[O]=1,K[ht]=O;lt.add(O)}ct&&console.warn("Duplicate headers found and renamed."),et=!0}return{data:c,errors:h,meta:{delimiter:i,linebreak:o,aborted:N,truncated:!!E,cursor:v+(W||0),renamedHeaders:it}}}function G(){_(T()),c=[],h=[]}},this.abort=function(){N=!0},this.getCharIndex=function(){return L}}function vt(e){var i=e.data,o=B[i.workerId],m=!1;if(i.error)o.userError(i.error,i.file);else if(i.results&&i.results.data){var _={abort:function(){m=!0,ut(i.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:mt,resume:mt};if(H(o.userStep)){for(var P=0;P<i.results.data.length&&(o.userStep({data:i.results.data[P],errors:i.results.errors,meta:i.results.meta},_),!m);P++);delete i.results}else H(o.userChunk)&&(o.userChunk(i.results,_,i.file),delete i.results)}i.finished&&!m&&ut(i.workerId,i.results)}function ut(e,i){var o=B[e];H(o.userComplete)&&o.userComplete(i),o.terminate(),delete B[e]}function mt(){throw new Error("Not implemented.")}function gt(e){if(typeof e!="object"||e===null)return e;var i,o=Array.isArray(e)?[]:{};for(i in e)o[i]=gt(e[i]);return o}function ot(e,i){return function(){e.apply(i,arguments)}}function H(e){return typeof e=="function"}return b.parse=function(e,i){var o=(i=i||{}).dynamicTyping||!1;if(H(o)&&(i.dynamicTypingFunction=o,o={}),i.dynamicTyping=o,i.transform=!!H(i.transform)&&i.transform,!i.worker||!b.WORKERS_SUPPORTED)return o=null,b.NODE_STREAM_INPUT,typeof e=="string"?(e=(m=>m.charCodeAt(0)!==65279?m:m.slice(1))(e),o=new(i.download?U:q)(i)):e.readable===!0&&H(e.read)&&H(e.on)?o=new st(i):(n.File&&e instanceof File||e instanceof Object)&&(o=new Y(i)),o.stream(e);(o=(()=>{var m;return!!b.WORKERS_SUPPORTED&&(m=(()=>{var _=n.URL||n.webkitURL||null,P=r.toString();return b.BLOB_URL||(b.BLOB_URL=_.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",P,")();"],{type:"text/javascript"})))})(),(m=new n.Worker(m)).onmessage=vt,m.id=j++,B[m.id]=m)})()).userStep=i.step,o.userChunk=i.chunk,o.userComplete=i.complete,o.userError=i.error,i.step=H(i.step),i.chunk=H(i.chunk),i.complete=H(i.complete),i.error=H(i.error),delete i.worker,o.postMessage({input:e,config:i,workerId:o.id})},b.unparse=function(e,i){var o=!1,m=!0,_=",",P=`\r
`,Q='"',it=Q+Q,et=!1,M=null,X=!1,L=((()=>{if(typeof i=="object"){if(typeof i.delimiter!="string"||b.BAD_DELIMITERS.filter(function(W){return i.delimiter.indexOf(W)!==-1}).length||(_=i.delimiter),typeof i.quotes!="boolean"&&typeof i.quotes!="function"&&!Array.isArray(i.quotes)||(o=i.quotes),typeof i.skipEmptyLines!="boolean"&&typeof i.skipEmptyLines!="string"||(et=i.skipEmptyLines),typeof i.newline=="string"&&(P=i.newline),typeof i.quoteChar=="string"&&(Q=i.quoteChar),typeof i.header=="boolean"&&(m=i.header),Array.isArray(i.columns)){if(i.columns.length===0)throw new Error("Option columns is empty");M=i.columns}i.escapeChar!==void 0&&(it=i.escapeChar+Q),i.escapeFormulae instanceof RegExp?X=i.escapeFormulae:typeof i.escapeFormulae=="boolean"&&i.escapeFormulae&&(X=/^[=+\-@\t\r].*$/)}})(),new RegExp(nt(Q),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return N(null,e,et);if(typeof e[0]=="object")return N(M||Object.keys(e[0]),e,et)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||M),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),N(e.fields||[],e.data||[],et);throw new Error("Unable to serialize unrecognized input");function N(W,y,a){var s="",l=(typeof W=="string"&&(W=JSON.parse(W)),typeof y=="string"&&(y=JSON.parse(y)),Array.isArray(W)&&0<W.length),x=!Array.isArray(y[0]);if(l&&m){for(var f=0;f<W.length;f++)0<f&&(s+=_),s+=I(W[f],f);0<y.length&&(s+=P)}for(var c=0;c<y.length;c++){var h=(l?W:y[c]).length,u=!1,v=l?Object.keys(y[c]).length===0:y[c].length===0;if(a&&!l&&(u=a==="greedy"?y[c].join("").trim()==="":y[c].length===1&&y[c][0].length===0),a==="greedy"&&l){for(var R=[],w=0;w<h;w++){var F=x?W[w]:w;R.push(y[c][F])}u=R.join("").trim()===""}if(!u){for(var S=0;S<h;S++){0<S&&!v&&(s+=_);var C=l&&x?W[S]:S;s+=I(y[c][C],S)}c<y.length-1&&(!a||0<h&&!v)&&(s+=P)}}return s}function I(W,y){var a,s;return W==null?"":W.constructor===Date?JSON.stringify(W).slice(1,25):(s=!1,X&&typeof W=="string"&&X.test(W)&&(W="'"+W,s=!0),a=W.toString().replace(L,it),(s=s||o===!0||typeof o=="function"&&o(W,y)||Array.isArray(o)&&o[y]||((l,x)=>{for(var f=0;f<x.length;f++)if(-1<l.indexOf(x[f]))return!0;return!1})(a,b.BAD_DELIMITERS)||-1<a.indexOf(_)||a.charAt(0)===" "||a.charAt(a.length-1)===" ")?Q+a+Q:a)}},b.RECORD_SEP="",b.UNIT_SEP="",b.BYTE_ORDER_MARK="\uFEFF",b.BAD_DELIMITERS=["\r",`
`,'"',b.BYTE_ORDER_MARK],b.WORKERS_SUPPORTED=!g&&!!n.Worker,b.NODE_STREAM_INPUT=1,b.LocalChunkSize=10485760,b.RemoteChunkSize=5242880,b.DefaultDelimiter=",",b.Parser=dt,b.ParserHandle=at,b.NetworkStreamer=U,b.FileStreamer=Y,b.StringStreamer=q,b.ReadableStreamStreamer=st,n.jQuery&&((d=n.jQuery).fn.parse=function(e){var i=e.config||{},o=[];return this.each(function(P){if(!(d(this).prop("tagName").toUpperCase()==="INPUT"&&d(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var Q=0;Q<this.files.length;Q++)o.push({file:this.files[Q],inputElem:this,instanceConfig:d.extend({},i)})}),m(),this;function m(){if(o.length===0)H(e.complete)&&e.complete();else{var P,Q,it,et,M=o[0];if(H(e.before)){var X=e.before(M.file,M.inputElem);if(typeof X=="object"){if(X.action==="abort")return P="AbortError",Q=M.file,it=M.inputElem,et=X.reason,void(H(e.error)&&e.error({name:P},Q,it,et));if(X.action==="skip")return void _();typeof X.config=="object"&&(M.instanceConfig=d.extend(M.instanceConfig,X.config))}else if(X==="skip")return void _()}var L=M.instanceConfig.complete;M.instanceConfig.complete=function(N){H(L)&&L(N,M.file,M.inputElem),_()},b.parse(M.file,M.instanceConfig)}}function _(){o.splice(0,1),m()}}),p&&(n.onmessage=function(e){e=e.data,b.WORKER_ID===void 0&&e&&(b.WORKER_ID=e.workerId),typeof e.input=="string"?n.postMessage({workerId:b.WORKER_ID,results:b.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=b.parse(e.input,e.config))&&n.postMessage({workerId:b.WORKER_ID,results:e,finished:!0})}),(U.prototype=Object.create(D.prototype)).constructor=U,(Y.prototype=Object.create(D.prototype)).constructor=Y,(q.prototype=Object.create(q.prototype)).constructor=q,(st.prototype=Object.create(D.prototype)).constructor=st,b})}(_t)),_t.exports}var Bt=Pt();const Mt=Tt(Bt),xt=class xt{async loadCSV(t,r){const n=t.split(","),d=n.length;let g=[];for(let p=0;p<d;p++){const B=await this.loadSingleCSV(n[p],j=>{r(Math.floor((p+j/100)/d*100))});g=g.concat(B)}return g}async loadSingleCSV(t,r){const n=await fetch(t),d=t.split("/").pop(),g=xt.FILE_SIZES[d],p=n.body.getReader();let B=0;const j=[];for(;;){const{done:U,value:Y}=await p.read();if(U)break;j.push(Y),g&&r&&(B+=Y.length,r(B/g*100))}const D=await new Blob(j).text();return new Promise((U,Y)=>{Mt.parse(D,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:q=>{!q.data||q.data.length===0?Y(new Error("CSV file contains no data")):U(q.data)},error:q=>Y(q)})})}processData(t){const r=["id","title","x","y","size","r","g","b"],n=t[0];for(const D of r)if(!(D in n))throw new Error(`CSV is missing required field: ${D}`);const d=t.length,g=new Float32Array(d*2),p=new Float32Array(d),B=new Float32Array(d*4),j=new Array(d),b=new Array(d);for(let D=0;D<d;D++){const U=t[D];g[D*2]=parseFloat(U.x),g[D*2+1]=parseFloat(U.y),p[D]=parseFloat(U.size),B[D*4]=parseFloat(U.r),B[D*4+1]=parseFloat(U.g),B[D*4+2]=parseFloat(U.b),B[D*4+3]=1,j[D]=U.title,b[D]=parseInt(U.id)}return{numItems:d,offsets:g,sizes:p,colors:B,titles:j,ids:b}}};St(xt,"FILE_SIZES",{"layout60k-Sep-10-2024.csv":6792224,"layout500k-Sep-10-2024.csv":57693366,"layout1m-part1-Sep-10-2024.csv":59988553,"layout1m-part2-Sep-10-2024.csv":56877942});let wt=xt;var bt={exports:{}},Ot=bt.exports,Et;function Ut(){return Et||(Et=1,function(Z){((t,r)=>{Z.exports?Z.exports=r():t.fuzzysort=r()})(Ot,t=>{var r=(a,s)=>{if(!a||!s)return N;var l=st(a);et(s)||(s=q(s));var x=l.bitflags;return(x&s._bitflags)!==x?N:nt(l,s)},n=(a,s,l)=>{if(!a)return l!=null&&l.all?at(s,l):L;var x=st(a),f=x.bitflags,c=x.containsSpace,h=U((l==null?void 0:l.threshold)||0),u=(l==null?void 0:l.limit)||M,v=0,R=0,w=s.length;function F(ct){v<u?(y.add(ct),++v):(++R,ct._score>y.peek()._score&&y.replaceTop(ct))}if(l!=null&&l.key)for(var S=l.key,C=0;C<w;++C){var z=s[C],A=it(z,S);if(A&&(et(A)||(A=q(A)),(f&A._bitflags)===f)){var k=nt(x,A);k!==N&&(k._score<h||(k.obj=z,F(k)))}}else if(l!=null&&l.keys){var rt=l.keys,J=rt.length;t:for(var C=0;C<w;++C){var z=s[C];{for(var tt=0,T=0;T<J;++T){var S=rt[T],A=it(z,S);if(!A){P[T]=I;continue}et(A)||(A=q(A)),P[T]=A,tt|=A._bitflags}if((f&tt)!==f)continue}if(c)for(let O=0;O<x.spaceSearches.length;O++)m[O]=X;for(var T=0;T<J;++T){if(A=P[T],A===I){Q[T]=I;continue}if(Q[T]=nt(x,A,!1,c),Q[T]===N){Q[T]=I;continue}if(c)for(let V=0;V<x.spaceSearches.length;V++){if(_[V]>-1e3&&m[V]>X){var G=(m[V]+_[V])/4;G>m[V]&&(m[V]=G)}_[V]>m[V]&&(m[V]=_[V])}}if(c){for(let O=0;O<x.spaceSearches.length;O++)if(m[O]===X)continue t}else{var E=!1;for(let O=0;O<J;O++)if(Q[O]._score!==X){E=!0;break}if(!E)continue}var K=new j(J);for(let O=0;O<J;O++)K[O]=Q[O];if(c){var $=0;for(let O=0;O<x.spaceSearches.length;O++)$+=m[O]}else{var $=X;for(let V=0;V<J;V++){var k=K[V];if(k._score>-1e3&&$>X){var G=($+k._score)/4;G>$&&($=G)}k._score>$&&($=k._score)}}if(K.obj=z,K._score=$,l!=null&&l.scoreFn){if($=l.scoreFn(K),!$)continue;$=U($),K._score=$}$<h||F(K)}}else for(var C=0;C<w;++C){var A=s[C];if(A&&(et(A)||(A=q(A)),(f&A._bitflags)===f)){var k=nt(x,A);k!==N&&(k._score<h||F(k))}}if(v===0)return L;for(var lt=new Array(v),C=v-1;C>=0;--C)lt[C]=y.poll();return lt.total=v+R,lt},d=(a,s="<b>",l="</b>")=>{for(var x=typeof s=="function"?s:void 0,f=a.target,c=f.length,h=a.indexes,u="",v=0,R=0,w=!1,F=[],S=0;S<c;++S){var C=f[S];if(h[R]===S){if(++R,w||(w=!0,x?(F.push(u),u=""):u+=s),R===h.length){x?(u+=C,F.push(x(u,v++)),u="",F.push(f.substr(S+1))):u+=C+l+f.substr(S+1);break}}else w&&(w=!1,x?(F.push(x(u,v++)),u=""):u+=l);u+=C}return x?F:u},g=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a="");var s=ut(a);return b(a,{_targetLower:s._lower,_targetLowerCodes:s.lowerCodes,_bitflags:s.bitflags})},p=()=>{ot.clear(),H.clear()};class B{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((s,l)=>s-l)}set indexes(s){return this._indexes=s}highlight(s,l){return d(this,s,l)}get score(){return D(this._score)}set score(s){this._score=U(s)}}class j extends Array{get score(){return D(this._score)}set score(s){this._score=U(s)}}var b=(a,s)=>{const l=new B;return l.target=a,l.obj=s.obj??N,l._score=s._score??X,l._indexes=s._indexes??[],l._targetLower=s._targetLower??"",l._targetLowerCodes=s._targetLowerCodes??N,l._nextBeginningIndexes=s._nextBeginningIndexes??N,l._bitflags=s._bitflags??0,l},D=a=>a===X?0:a>1?a:Math.E**(((-a+1)**.04307-1)*-2),U=a=>a===0?X:a>1?a:1-Math.pow(Math.log(a)/-2+1,1/.04307),Y=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a=""),a=a.trim();var s=ut(a),l=[];if(s.containsSpace){var x=a.split(/\s+/);x=[...new Set(x)];for(var f=0;f<x.length;f++)if(x[f]!==""){var c=ut(x[f]);l.push({lowerCodes:c.lowerCodes,_lower:x[f].toLowerCase(),containsSpace:!1})}}return{lowerCodes:s.lowerCodes,_lower:s._lower,containsSpace:s.containsSpace,bitflags:s.bitflags,spaceSearches:l}},q=a=>{if(a.length>999)return g(a);var s=ot.get(a);return s!==void 0||(s=g(a),ot.set(a,s)),s},st=a=>{if(a.length>999)return Y(a);var s=H.get(a);return s!==void 0||(s=Y(a),H.set(a,s)),s},at=(a,s)=>{var l=[];l.total=a.length;var x=(s==null?void 0:s.limit)||M;if(s!=null&&s.key)for(var f=0;f<a.length;f++){var c=a[f],h=it(c,s.key);if(h!=N){et(h)||(h=q(h));var u=b(h.target,{_score:h._score,obj:c});if(l.push(u),l.length>=x)return l}}else if(s!=null&&s.keys)for(var f=0;f<a.length;f++){for(var c=a[f],v=new j(s.keys.length),R=s.keys.length-1;R>=0;--R){var h=it(c,s.keys[R]);if(!h){v[R]=I;continue}et(h)||(h=q(h)),h._score=X,h._indexes.len=0,v[R]=h}if(v.obj=c,v._score=X,l.push(v),l.length>=x)return l}else for(var f=0;f<a.length;f++){var h=a[f];if(h!=N&&(et(h)||(h=q(h)),h._score=X,h._indexes.len=0,l.push(h),l.length>=x))return l}return l},nt=(a,s,l=!1,x=!1)=>{if(l===!1&&a.containsSpace)return dt(a,s,x);for(var f=a._lower,c=a.lowerCodes,h=c[0],u=s._targetLowerCodes,v=c.length,R=u.length,C=0,w=0,F=0;;){var S=h===u[w];if(S){if(e[F++]=w,++C,C===v)break;h=c[C]}if(++w,w>=R)return N}var C=0,z=!1,A=0,k=s._nextBeginningIndexes;k===N&&(k=s._nextBeginningIndexes=gt(s.target)),w=e[0]===0?0:k[e[0]-1];var rt=0;if(w!==R)for(;;)if(w>=R){if(C<=0||(++rt,rt>200))break;--C;var J=i[--A];w=k[J]}else{var S=c[C]===u[w];if(S){if(i[A++]=w,++C,C===v){z=!0;break}++w}else w=k[w]}var tt=v<=1?-1:s._targetLower.indexOf(f,e[0]),T=!!~tt,G=T?tt===0||s._nextBeginningIndexes[tt-1]===tt:!1;if(T&&!G){for(var E=0;E<k.length;E=k[E])if(!(E<=tt)){for(var K=0;K<v&&c[K]===s._targetLowerCodes[E+K];K++);if(K===v){tt=E,G=!0;break}}}var $=O=>{for(var V=0,pt=0,ft=1;ft<v;++ft)O[ft]-O[ft-1]!==1&&(V-=O[ft],++pt);var Lt=O[v-1]-O[0]-(v-1);if(V-=(12+Lt)*pt,O[0]!==0&&(V-=O[0]*O[0]*.2),!z)V*=1e3;else{for(var yt=1,ft=k[0];ft<R;ft=k[ft])++yt;yt>24&&(V*=(yt-24)*10)}return V-=(R-v)/2,T&&(V/=1+v*v*1),G&&(V/=1+v*v*1),V-=(R-v)/2,V};if(z)if(G){for(var E=0;E<v;++E)e[E]=tt+E;var lt=e,ct=$(e)}else var lt=i,ct=$(i);else{if(T)for(var E=0;E<v;++E)e[E]=tt+E;var lt=e,ct=$(lt)}s._score=ct;for(var E=0;E<v;++E)s._indexes[E]=lt[E];s._indexes.len=v;const ht=new B;return ht.target=s.target,ht._score=s._score,ht._indexes=s._indexes,ht},dt=(a,s,l)=>{for(var x=new Set,f=0,c=N,h=0,u=a.spaceSearches,v=u.length,R=0,w=()=>{for(let G=R-1;G>=0;G--)s._nextBeginningIndexes[o[G*2+0]]=o[G*2+1]},F=!1,T=0;T<v;++T){_[T]=X;var S=u[T];if(c=nt(S,s),l){if(c===N)continue;F=!0}else if(c===N)return w(),N;var C=T===v-1;if(!C){var z=c._indexes,A=!0;for(let E=0;E<z.len-1;E++)if(z[E+1]-z[E]!==1){A=!1;break}if(A){var k=z[z.len-1]+1,rt=s._nextBeginningIndexes[k-1];for(let E=k-1;E>=0&&rt===s._nextBeginningIndexes[E];E--)s._nextBeginningIndexes[E]=k,o[R*2+0]=E,o[R*2+1]=rt,R++}}f+=c._score/v,_[T]=c._score/v,c._indexes[0]<h&&(f-=(h-c._indexes[0])*2),h=c._indexes[0];for(var J=0;J<c._indexes.len;++J)x.add(c._indexes[J])}if(l&&!F)return N;w();var tt=nt(a,s,!0);if(tt!==N&&tt._score>f){if(l)for(var T=0;T<v;++T)_[T]=tt._score/v;return tt}l&&(c=s),c._score=f;var T=0;for(let G of x)c._indexes[T++]=G;return c._indexes.len=T,c},vt=a=>a.replace(new RegExp("\\p{Script=Latin}+","gu"),s=>s.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),ut=a=>{a=vt(a);for(var s=a.length,l=a.toLowerCase(),x=[],f=0,c=!1,h=0;h<s;++h){var u=x[h]=l.charCodeAt(h);if(u===32){c=!0;continue}var v=u>=97&&u<=122?u-97:u>=48&&u<=57?26:u<=127?30:31;f|=1<<v}return{lowerCodes:x,bitflags:f,containsSpace:c,_lower:l}},mt=a=>{for(var s=a.length,l=[],x=0,f=!1,c=!1,h=0;h<s;++h){var u=a.charCodeAt(h),v=u>=65&&u<=90,R=v||u>=97&&u<=122||u>=48&&u<=57,w=v&&!f||!c||!R;f=v,c=R,w&&(l[x++]=h)}return l},gt=a=>{a=vt(a);for(var s=a.length,l=mt(a),x=[],f=l[0],c=0,h=0;h<s;++h)f>h?x[h]=f:(f=l[++c],x[h]=f===void 0?s:f);return x},ot=new Map,H=new Map,e=[],i=[],o=[],m=[],_=[],P=[],Q=[],it=(a,s)=>{var l=a[s];if(l!==void 0)return l;if(typeof s=="function")return s(a);var x=s;Array.isArray(s)||(x=s.split("."));for(var f=x.length,c=-1;a&&++c<f;)a=a[x[c]];return a},et=a=>typeof a=="object"&&typeof a._bitflags=="number",M=1/0,X=-M,L=[];L.total=0;var N=null,I=g(""),W=a=>{var s=[],l=0,x={},f=c=>{for(var h=0,u=s[h],v=1;v<l;){var R=v+1;h=v,R<l&&s[R]._score<s[v]._score&&(h=R),s[h-1>>1]=s[h],v=1+(h<<1)}for(var w=h-1>>1;h>0&&u._score<s[w]._score;w=(h=w)-1>>1)s[h]=s[w];s[h]=u};return x.add=c=>{var h=l;s[l++]=c;for(var u=h-1>>1;h>0&&c._score<s[u]._score;u=(h=u)-1>>1)s[h]=s[u];s[h]=c},x.poll=c=>{if(l!==0){var h=s[0];return s[0]=s[--l],f(),h}},x.peek=c=>{if(l!==0)return s[0]},x.replaceTop=c=>{s[0]=c,f()},x},y=W();return{single:r,go:n,prepare:g,cleanup:p}})}(bt)),bt.exports}var Yt=Ut();const Wt=Tt(Yt);class Xt{constructor(t,r){this.visualization=t,this.controls=r,this.searchInput=document.getElementById("search"),this.resultsContainer=document.getElementById("search-results"),this.loadingIndicator=document.querySelector(".search-loading"),this.searchButton=document.getElementById("search-button"),this.searchButton.addEventListener("click",()=>this.performSearch()),this.searchInput.addEventListener("input",()=>this.clearResults())}showLoading(t){this.loadingIndicator&&(this.loadingIndicator.style.display=t?"block":"none")}performSearch(){const t=this.searchInput.value.trim();if(!t){this.clearResults();return}this.showLoading(!0);try{const r=Wt.go(t,this.visualization.processedData.titles,{limit:5,threshold:-1e4});this.displayResults(r)}catch(r){console.error("Search error:",r)}finally{this.showLoading(!1)}}displayResults(t){if(t.length===0){this.resultsContainer.innerHTML='<div class="search-result-empty">No results found</div>',this.resultsContainer.style.display="block";return}this.resultsContainer.innerHTML=t.map(r=>`<div class="search-result-item" data-title="${r.target}">${r.target}</div>`).join(""),this.resultsContainer.style.display="block",this.resultsContainer.querySelectorAll(".search-result-item").forEach(r=>{r.addEventListener("click",n=>this.handleResultClick(n))})}handleResultClick(t){const r=t.target.closest(".search-result-item").dataset.title;this.clearSearch(),this.handleSearchResult(r)}handleSearchResult(t){const r=this.visualization.processedData.titles.indexOf(t);if(r===-1)return;const n=this.visualization.processedData.offsets[r*2],d=this.visualization.processedData.offsets[r*2+1],g=this.visualization.processedData.sizes[r]*5;this.controls.smoothTransition(n,d,g,!0)}clearSearch(){this.searchInput.value="",this.clearResults(),this.showLoading(!1)}clearResults(){this.resultsContainer.innerHTML="",this.resultsContainer.style.display="none"}}class Nt{constructor(t,r){this.zoomLevel=1,this.cameraX=0,this.cameraY=0,this.isDragging=!1,this.wasDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.transitionActive=!1,this.startState=null,this.endState=null,this.midState=null,this.stageCount=0,this.stage=0,this.stage1Duration=2e3,this.stage2Duration=2e3,this.transitionStartTime=0,this.wheelSensitivity=.002,this.touchSensitivity=.004,this.lastTouchDistance=null,this.canvas=t,this.visualization=r,this.canvas.addEventListener("mousedown",n=>this.handleMouseDown(n)),this.canvas.addEventListener("touchstart",n=>this.handleTouchStart(n),{passive:!1}),this.canvas.addEventListener("mouseup",()=>this.isDragging=!1),this.canvas.addEventListener("touchend",()=>this.isDragging=!1),this.canvas.addEventListener("mousemove",n=>this.handleMouseMove(n)),this.canvas.addEventListener("touchmove",n=>this.handleTouchMove(n),{passive:!1}),this.canvas.addEventListener("wheel",n=>this.handleZoom(n),{passive:!0}),this.canvas.addEventListener("click",n=>{this.wasDragging||this.clickArticle(n),this.wasDragging=!1}),document.getElementById("random-button").addEventListener("click",()=>this.goToRandomArticle())}handleMouseDown(t){this.transitionActive||(this.isDragging=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY)}handleMouseMove(t){!this.isDragging||this.transitionActive||(this.wasDragging=!0,this.updateCameraPosition(t.clientX,t.clientY))}handleTouchStart(t){if(!this.transitionActive){if(t.touches.length===2){t.preventDefault(),this.lastTouchDistance=this.getTouchDistance(t.touches);return}t.touches.length===1&&(t.preventDefault(),this.isDragging=!0,this.lastMouseX=t.touches[0].clientX,this.lastMouseY=t.touches[0].clientY)}}handleTouchMove(t){if(!this.transitionActive){if(t.touches.length===2){t.preventDefault();const r=this.getTouchDistance(t.touches),n=(t.touches[0].clientX+t.touches[1].clientX)/2,d=(t.touches[0].clientY+t.touches[1].clientY)/2,g=r/this.lastTouchDistance,p=this.screenToWorld(n,d);this.zoomLevel*=1/g;const B=this.screenToWorld(n,d);this.cameraX+=p.x-B.x,this.cameraY+=p.y-B.y,this.lastTouchDistance=r;return}!this.isDragging||t.touches.length!==1||(t.preventDefault(),this.wasDragging=!0,this.updateCameraPosition(t.touches[0].clientX,t.touches[0].clientY))}}getTouchDistance(t){const r=t[0].clientX-t[1].clientX,n=t[0].clientY-t[1].clientY;return Math.hypot(r,n)}handleZoom(t){if(this.transitionActive)return;const n=Number.isInteger(t.deltaY)&&t.deltaX===0?this.wheelSensitivity:this.touchSensitivity,d=Math.exp(t.deltaY*n),g=this.screenToWorld(t.clientX,t.clientY);this.zoomLevel*=d;const p=this.screenToWorld(t.clientX,t.clientY);this.cameraX+=g.x-p.x,this.cameraY+=g.y-p.y}screenToWorld(t,r){const n=this.canvas.getBoundingClientRect(),d=n.width,g=n.height,p=(t-n.left)/d,B=(r-n.top)/g,j=p*2-1,b=-(B*2-1),D=d/g,U=this.cameraX+j*this.zoomLevel*D,Y=this.cameraY+b*this.zoomLevel;return{x:U,y:Y}}updateCameraPosition(t,r){const n=this.screenToWorld(this.lastMouseX,this.lastMouseY),d=this.screenToWorld(t,r);this.cameraX+=n.x-d.x,this.cameraY+=n.y-d.y,this.lastMouseX=t,this.lastMouseY=r}smoothTransition(t,r,n,d){if(this.transitionActive=!0,this.startState={x:this.cameraX,y:this.cameraY,zoom:this.zoomLevel},this.endState={x:t,y:r,zoom:n},this.stage1Duration=2e3,this.stage2Duration=2e3,d===!1)this.stageCount=1;else{const g=this.endState.x-this.startState.x,p=this.endState.y-this.startState.y,B=Math.hypot(g,p),j=Math.max(this.startState.zoom,B*.8);this.midState={x:this.cameraX,y:this.cameraY,zoom:j},this.stageCount=2,this.stage=0,this.zoomLevel===j&&(this.stage1Duration=0)}this.transitionStartTime=performance.now()}updateTransition(t){const r=t-this.transitionStartTime;let n;this.stageCount===1?n=this.stage1Duration:this.stage===0?n=this.stage1Duration:n=this.stage2Duration;const d=Math.min(r/n,1),g=d<.5?2*d*d:1-Math.pow(-2*d+2,2)/2;if(this.stageCount===1)this.zoomLevel=this.startState.zoom+(this.endState.zoom-this.startState.zoom)*g,d>=1&&(this.cameraX=this.endState.x,this.cameraY=this.endState.y,this.transitionActive=!1);else if(this.stageCount===2&&this.stage===0)this.zoomLevel=this.startState.zoom+(this.midState.zoom-this.startState.zoom)*g,d>=1&&(this.stage=1,this.transitionStartTime=t);else if(this.stageCount===2&&this.stage===1){const p=this.midState,B=this.endState;this.cameraX=p.x+(B.x-p.x)*g,this.cameraY=p.y+(B.y-p.y)*g,this.zoomLevel=p.zoom+(B.zoom-p.zoom)*g,d>=1&&(this.transitionActive=!1)}}reset(){this.cameraX=0,this.cameraY=0,this.zoomLevel=1,this.smoothTransition(0,0,60,!1)}clickArticle(t){const r=this.screenToWorld(t.clientX,t.clientY);console.log("cursor",r);const{offsets:n,sizes:d,ids:g,titles:p,numItems:B}=this.visualization.processedData;for(let j=0;j<B;j++){const b=n[j*2],D=n[j*2+1],U=d[j],Y=r.x-b,q=r.y-D;if(Math.sqrt(Y*Y+q*q)<=U){const at=g[j],nt=p[j];console.log(b,D,U),console.log(`Clicked on article: ${nt} (ID: ${at})`),this.showEmbeddedWikiArticle(at);return}}}showEmbeddedWikiArticle(t){const r=document.getElementById("wiki-embed-container"),n=document.getElementById("wiki-iframe"),d=document.getElementById("close-wiki-btn"),g=`https://en.wikipedia.org/?curid=${t}`;n.src=g,r.classList.add("active"),this._outsideClickHandler||(this._outsideClickHandler=p=>{!r.contains(p.target)&&r.classList.contains("active")&&!p.target.closest("#webgl-canvas")&&d.click()}),d.onclick=()=>{r.classList.remove("active"),document.removeEventListener("click",this._outsideClickHandler),setTimeout(()=>{n.src="about:blank"},300)},document.addEventListener("click",this._outsideClickHandler)}goToRandomArticle(){const t=Math.floor(Math.random()*this.visualization.processedData.numItems),r=this.visualization.processedData.offsets[t*2],n=this.visualization.processedData.offsets[t*2+1],d=this.visualization.processedData.sizes[t]*5;this.smoothTransition(r,n,d,!0)}}document.addEventListener("DOMContentLoaded",()=>{try{new Vt}catch(Z){console.error("Failed to initialize application:",Z),alert("Failed to initialize the application. See console for details.")}});class Vt{constructor(){this.canvas=document.getElementById("webgl-canvas"),this.webgl=new Dt(this.canvas),this.textRenderer=new zt(this.webgl.gl),this.circleRenderer=new It(this.webgl.gl),this.controls=new Nt(this.canvas,this),this.DataLoader=new wt,this.searchManager=new Xt(this,this.controls),this.processedData=null,this.animationFrameId=null,this.initializing=!1,this.lastTextUpdateTime=0,this.textUpdateInterval=1e3,this.fpsCounter=document.getElementById("fps-counter"),this.pctEl=document.getElementById("loading-percent"),this.lastFrameTime=0,this.frameCount=0,this.lastFpsUpdate=0,this.fps=0,document.getElementById("load-button").addEventListener("click",()=>this.initialize()),this.setupIntroOverlay()}setupIntroOverlay(){const t=document.getElementById("intro-overlay"),r=document.getElementById("start-exploration"),n=document.getElementById("csv-select");r.addEventListener("click",()=>{const d=document.querySelector('input[name="dataset"]:checked').value;n.value=d,t.style.display="none",this.initialize()})}async initialize(){if(this.initializing)return;this.initializing=!0;const r=document.getElementById("csv-select").value;this.showLoadingIndicator(!0);const n=await this.DataLoader.loadCSV(r,d=>{this.pctEl.textContent=`${Math.floor(d)}%`});console.log(`Loaded ${n.length} data points from CSV`),this.processedData=this.DataLoader.processData(n),console.log(`Processed data: ${this.processedData.numItems} items`),this.circleRenderer.setData(this.processedData),await this.textRenderer.loadFont(),this.updateVisibleText(),this.controls.reset(),this.animationFrameId||this.startRenderLoop(),this.showLoadingIndicator(!1),this.initializing=!1}startRenderLoop(){this.lastFrameTime=performance.now(),this.lastFpsUpdate=this.lastFrameTime,this.frameCount=0,this.animationFrameId=requestAnimationFrame(t=>this.draw(t))}showLoadingIndicator(t){const r=document.getElementById("loading");r.style.display=t?"flex":"none"}updateFpsCounter(t){this.frameCount++,t-this.lastFpsUpdate>=500&&(this.fps=Math.round(this.frameCount*1e3/(t-this.lastFpsUpdate)),this.fpsCounter&&(this.fpsCounter.textContent=`${this.fps} FPS`),this.lastFpsUpdate=t,this.frameCount=0)}updateVisibleText(){const t=this.controls.screenToWorld(0,0),r=this.controls.screenToWorld(this.canvas.width,this.canvas.height),n={minX:Math.min(t.x,r.x),maxX:Math.max(t.x,r.x),minY:Math.min(t.y,r.y),maxY:Math.max(t.y,r.y)};if((n.maxX-n.minX)*(n.maxY-n.minY)>3e3)return;const g=[],{offsets:p,sizes:B,titles:j,numItems:b}=this.processedData;for(let Y=0;Y<b;Y++){const q=p[Y*2],st=p[Y*2+1];q>=n.minX&&q<=n.maxX&&st>=n.minY&&st<=n.maxY&&g.push({text:j[Y],x:q,y:st,limit:2*B[Y],cx:.51,cy:.5,radius:B[Y]})}const D=1e3;let U=g;g.length>D&&(U=g.sort((Y,q)=>q.radius-Y.radius).slice(0,D)),console.log(`Showing ${U.length} labels out of ${g.length} visible circles`),this.textRenderer.batchAddText(U)}draw(t){this.webgl.clear(),this.webgl.resizeCanvas(),this.updateFpsCounter(t),this.controls.transitionActive&&this.controls.updateTransition(t),t-this.lastTextUpdateTime>this.textUpdateInterval&&(this.updateVisibleText(),this.lastTextUpdateTime=t);const r=this.webgl.createProjectionMatrix(this.controls.cameraX,this.controls.cameraY,this.controls.zoomLevel);this.circleRenderer.draw(r,this.controls.zoomLevel),this.textRenderer.draw(r),this.animationFrameId=requestAnimationFrame(n=>this.draw(n))}}
