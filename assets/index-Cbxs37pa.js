var Pt=Object.defineProperty;var At=(k,t,e)=>t in k?Pt(k,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):k[t]=e;var yt=(k,t,e)=>At(k,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();class St{constructor(){this.canvas=document.getElementById("webgl-canvas"),this.gl=this.canvas.getContext("webgl2"),this.initWebGL()}initWebGL(){if(!this.gl){console.error("Could not find WebGL, try turning on hardware acceleration, use another browser, or use another device");return}this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.resizeCanvas()}resizeCanvas(){const t=window.devicePixelRatio||1,{width:e,height:i}=this.canvas.getBoundingClientRect(),r=Math.round(e*t),a=Math.round(i*t);(this.canvas.width!==r||this.canvas.height!==a)&&(this.canvas.width=r,this.canvas.height=a,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}createProjectionMatrix(t,e,i){const r=this.canvas.width/this.canvas.height,a=i,o=i*r,u=t-o/2,g=t+o/2,l=e-a/2,y=e+a/2;return new Float32Array([2/(g-u),0,0,0,0,2/(y-l),0,0,0,0,-1,0,-(g+u)/(g-u),-(y+l)/(y-l),0,1])}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}class Tt{constructor(t){this.gl=t,this.program=null,this.locations={}}createShader(t,e){const i=this.gl.createShader(t);return this.gl.shaderSource(i,e),this.gl.compileShader(i),i}createProgram(t,e){const i=this.createShader(this.gl.VERTEX_SHADER,t),r=this.createShader(this.gl.FRAGMENT_SHADER,e),a=this.gl.createProgram();return this.gl.attachShader(a,i),this.gl.attachShader(a,r),this.gl.linkProgram(a),this.gl.deleteShader(i),this.gl.deleteShader(r),a}}class Ct extends Tt{constructor(t){super(t.webgl.gl),this.numCircles=0,this.offsets=null,this.sizes=null,this.colors=null,this.titles=null,this.ids=null,this.vao=null,this.buffers={position:null,offset:null,size:null,color:null},this.initShaders()}initShaders(){const t=`#version 300 es
			in vec2 point;      
			in vec2 position;   
			in float size;
			in vec4 color;      
			uniform mat4 modelViewProjection; 
			uniform float cameraDistance;
			out vec2 vPoint;    
			out vec4 vColor;    

			void main() {
				vec2 scaledPosition = point * (size + cameraDistance) + position;
				gl_Position = modelViewProjection * vec4(scaledPosition, 0.0, 1.0);
				vPoint = point; // we give the position so it can be interpolated and we can use it to discard fragments outside the circle
				vColor = color; 
			}`,e=`#version 300 es
			precision highp float;
			in vec2 vPoint;     
			in vec4 vColor; 
			out vec4 fragColor;
			
			void main() {
				float dist = length(vPoint); 
				if (dist > 1.0) discard;     
				
				// Mix the color with white to make it more pastel
				vec3 pastelColor = mix(vColor.rgb, vec3(1.0), 0.3); 
				fragColor = vec4(pastelColor, vColor.a);
			}`;this.program=this.createProgram(t,e),this.locations={point:this.gl.getAttribLocation(this.program,"point"),position:this.gl.getAttribLocation(this.program,"position"),size:this.gl.getAttribLocation(this.program,"size"),color:this.gl.getAttribLocation(this.program,"color"),modelViewProjection:this.gl.getUniformLocation(this.program,"modelViewProjection"),cameraDistance:this.gl.getUniformLocation(this.program,"cameraDistance")}}initBuffers(){const t=this.gl;this.clean(),this.vao=t.createVertexArray(),t.bindVertexArray(this.vao);const e=new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]);this.buffers.position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.position),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(this.locations.point),t.vertexAttribPointer(this.locations.point,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.point,0),this.buffers.offset=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.offset),t.bufferData(t.ARRAY_BUFFER,this.offsets,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.position),t.vertexAttribPointer(this.locations.position,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.position,1),this.buffers.size=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.size),t.bufferData(t.ARRAY_BUFFER,this.sizes,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.size),t.vertexAttribPointer(this.locations.size,1,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.size,1),this.buffers.color=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.color),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.color),t.vertexAttribPointer(this.locations.color,4,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.color,1),t.bindVertexArray(null)}batchAddCircles(t){this.numCircles=t.numItems,this.offsets=t.offsets,this.sizes=t.sizes,this.colors=t.colors,this.titles=t.titles,this.ids=t.ids,this.initBuffers()}draw(t,e){const i=this.gl;i.useProgram(this.program),i.bindVertexArray(this.vao),i.uniformMatrix4fv(this.locations.modelViewProjection,!1,t),i.uniform1f(this.locations.cameraDistance,e),i.drawArraysInstanced(i.TRIANGLES,0,6,this.numCircles)}clean(){const t=this.gl;this.vao&&(t.deleteVertexArray(this.vao),this.vao=null),this.buffers.position&&(t.deleteBuffer(this.buffers.position),this.buffers.position=null),this.buffers.offset&&(t.deleteBuffer(this.buffers.offset),this.buffers.offset=null),this.buffers.size&&(t.deleteBuffer(this.buffers.size),this.buffers.size=null),this.buffers.color&&(t.deleteBuffer(this.buffers.color),this.buffers.color=null)}}class kt extends Tt{constructor(t){super(t.webgl.gl),this.fontInfo=null,this.characterCount=0,this.positions=null,this.charSizes=null,this.texturePositions=null,this.vao=null,this.texture=null,this.buffers={point:null,position:null,charSize:null,texturePosition:null},this.initShaders()}initShaders(){const t=`#version 300 es
			precision highp float;
			
			uniform mat4 modelViewProjection;
			uniform vec4 color;
		
			in vec3 position;
			in vec2 point;
			in vec2 charSize;
			in vec4 texturePosition;
		
			out vec2 vPoint;
			out vec4 vColor;
		
			void main() {
				
				vec3 pos = position + vec3(vec2(point) * charSize.xy, 0.0);
				gl_Position = modelViewProjection * vec4(pos, 1.0);
				vPoint = texturePosition.xy + point * texturePosition.zw;
				vColor = color;
			}`,e=`#version 300 es
			precision highp float;
			
			uniform sampler2D msdf;
			uniform float bias;
		
			in vec2 vPoint;
			in vec4 vColor;
		
			out vec4 fragColor;
		
			float median(float r, float g, float b) {
				return max(min(r, g), min(max(r, g), b));
			}
		
			void main() {
		
				if (vColor.a <= 0.0) {
					discard;
					return;
				}
				
				vec3 saple = texture(msdf, vPoint).rgb;
				float sigDist = median(saple.r, saple.g, saple.b) - bias;

				float alpha = clamp(sigDist / fwidth(sigDist) + bias, 0.0, 1.0);

				fragColor = vec4(vColor.rgb, vColor.a * alpha);
				
				if (fragColor.a < 0.01) discard;
			}`;this.program=this.createProgram(t,e),this.locations={position:this.gl.getAttribLocation(this.program,"position"),point:this.gl.getAttribLocation(this.program,"point"),charSize:this.gl.getAttribLocation(this.program,"charSize"),texturePosition:this.gl.getAttribLocation(this.program,"texturePosition"),modelViewProjection:this.gl.getUniformLocation(this.program,"modelViewProjection"),color:this.gl.getUniformLocation(this.program,"color"),bias:this.gl.getUniformLocation(this.program,"bias"),msdf:this.gl.getUniformLocation(this.program,"msdf")}}initBuffers(){const t=this.gl;this.clean(),this.vao=t.createVertexArray(),t.bindVertexArray(this.vao);const e=new Float32Array([0,0,1,0,1,1,1,1,0,0,0,1]);this.buffers.point=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.point),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(this.locations.point),t.vertexAttribPointer(this.locations.point,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.point,0),this.buffers.position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.position),t.bufferData(t.ARRAY_BUFFER,this.positions,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.position),t.vertexAttribPointer(this.locations.position,3,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.position,1),this.buffers.charSize=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.charSize),t.bufferData(t.ARRAY_BUFFER,this.charSizes,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.charSize),t.vertexAttribPointer(this.locations.charSize,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.charSize,1),this.buffers.texturePosition=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.texturePosition),t.bufferData(t.ARRAY_BUFFER,this.texturePositions,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.locations.texturePosition),t.vertexAttribPointer(this.locations.texturePosition,4,t.FLOAT,!1,0,0),t.vertexAttribDivisor(this.locations.texturePosition,1),t.bindVertexArray(null)}async loadFont(){try{const e=await(await fetch("/fonts/Roboto.json",{mode:"cors"})).json();return this.fontInfo=e,this.alphabet=new Map,e.chars.forEach(i=>{this.alphabet.set(String.fromCharCode(i.id),i)}),new Promise((i,r)=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{const o=this.gl;this.texture&&(o.deleteTexture(this.texture),this.texture=null),this.texture=o.createTexture(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0),o.bindTexture(o.TEXTURE_2D,this.texture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.bindTexture(o.TEXTURE_2D,null),this.sdfTextureWidth=a.width,this.sdfTextureHeight=a.height,i()},a.onerror=()=>{r(new Error("Failed to load font texture"))},a.src="/fonts/Roboto0.png"})}catch(t){throw console.error("Failed to load font:",t),t}}batchAddText(t){let e=0;for(const i of t)i.text&&(e+=i.text.length);this.characterCount=0,this.positions=new Float32Array(e*3),this.charSizes=new Float32Array(e*2),this.texturePositions=new Float32Array(e*4);for(const i of t)this.addText(i);this.initBuffers()}addText(t){let{text:e,x:i=0,y:r=0,z:a=0}=t,o=0,u=t.fontSize;if(t.limit!==void 0){let l=0;for(let y of e){const S=this.alphabet.get(y)||this.alphabet.get("?");l+=S.xadvance}u=t.limit*this.fontInfo.info.size/l}const g=u/this.fontInfo.info.size;if(t.cx!==void 0){let l=0;for(const y of e){const S=this.alphabet.get(y)||this.alphabet.get("_");l+=S.xadvance}o-=l*t.cx*g}t.cy!==void 0&&(r+=u*t.cy);for(let l=0;l<e.length;l++){const y=this.characterCount+l,S=e[l],f=this.alphabet.get(S)||this.alphabet.get("_"),w=y*3;this.positions[w]=i+o,this.positions[w+1]=r-f.yoffset*g,this.positions[w+2]=a;const j=y*2;this.charSizes[j]=u*f.width/42,this.charSizes[j+1]=-u*f.height/42;const Z=y*4;this.texturePositions[Z]=f.x/this.sdfTextureWidth,this.texturePositions[Z+1]=1-f.y/this.sdfTextureHeight,this.texturePositions[Z+2]=f.width/this.sdfTextureWidth,this.texturePositions[Z+3]=-f.height/this.sdfTextureHeight,o+=f.xadvance*g}this.characterCount+=e.length}draw(t){const e=this.gl;e.useProgram(this.program),e.bindVertexArray(this.vao),e.uniformMatrix4fv(this.locations.modelViewProjection,!1,t),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(this.locations.msdf,0),e.uniform4f(this.locations.color,1,1,1,1),e.uniform1f(this.locations.bias,.5),e.drawArraysInstanced(e.TRIANGLES,0,6,this.characterCount),e.bindVertexArray(null)}clean(){const t=this.gl;this.vao&&(t.deleteVertexArray(this.vao),this.vao=null),this.buffers.point&&(t.deleteBuffer(this.buffers.point),this.buffers.point=null),this.buffers.position&&(t.deleteBuffer(this.buffers.position),this.buffers.position=null),this.buffers.charSize&&(t.deleteBuffer(this.buffers.charSize),this.buffers.charSize=null),this.buffers.texturePosition&&(t.deleteBuffer(this.buffers.texturePosition),this.buffers.texturePosition=null)}}function Lt(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}var ct={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Dt=ct.exports,_t;function It(){return _t||(_t=1,(function(k,t){((e,i)=>{k.exports=i()})(Dt,function e(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},r,a=!i.document&&!!i.postMessage,o=i.IS_PAPA_WORKER||!1,u={},g=0,l={};function y(s){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(n){var h=ft(n);h.chunkSize=parseInt(h.chunkSize),n.step||n.chunk||(h.chunkSize=null),this._handle=new Z(h),(this._handle.streamer=this)._config=h}).call(this,s),this.parseChunk=function(n,h){var d=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<d){let _=this._config.newline;_||(c=this._config.quoteChar||'"',_=this._handle.guessLineEndings(n,c)),n=[...n.split(_).slice(d)].join(_)}this.isFirstChunk&&L(this._config.beforeFirstChunk)&&(c=this._config.beforeFirstChunk(n))!==void 0&&(n=c),this.isFirstChunk=!1,this._halted=!1;var d=this._partialLine+n,c=(this._partialLine="",this._handle.parse(d,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(n=c.meta.cursor,d=(this._finished||(this._partialLine=d.substring(n-this._baseIndex),this._baseIndex=n),c&&c.data&&(this._rowCount+=c.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)i.postMessage({results:c,workerId:l.WORKER_ID,finished:d});else if(L(this._config.chunk)&&!h){if(this._config.chunk(c,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=c=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(c.data),this._completeResults.errors=this._completeResults.errors.concat(c.errors),this._completeResults.meta=c.meta),this._completed||!d||!L(this._config.complete)||c&&c.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),d||c&&c.meta.paused||this._nextChunk(),c}this._halted=!0},this._sendError=function(n){L(this._config.error)?this._config.error(n):o&&this._config.error&&i.postMessage({workerId:l.WORKER_ID,error:n,finished:!1})}}function S(s){var n;(s=s||{}).chunkSize||(s.chunkSize=l.RemoteChunkSize),y.call(this,s),this._nextChunk=a?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(n=new XMLHttpRequest,this._config.withCredentials&&(n.withCredentials=this._config.withCredentials),a||(n.onload=it(this._chunkLoaded,this),n.onerror=it(this._chunkError,this)),n.open(this._config.downloadRequestBody?"POST":"GET",this._input,!a),this._config.downloadRequestHeaders){var h,d=this._config.downloadRequestHeaders;for(h in d)n.setRequestHeader(h,d[h])}var c;this._config.chunkSize&&(c=this._start+this._config.chunkSize-1,n.setRequestHeader("Range","bytes="+this._start+"-"+c));try{n.send(this._config.downloadRequestBody)}catch(_){this._chunkError(_.message)}a&&n.status===0&&this._chunkError()}},this._chunkLoaded=function(){n.readyState===4&&(n.status<200||400<=n.status?this._chunkError():(this._start+=this._config.chunkSize||n.responseText.length,this._finished=!this._config.chunkSize||this._start>=(h=>(h=h.getResponseHeader("Content-Range"))!==null?parseInt(h.substring(h.lastIndexOf("/")+1)):-1)(n),this.parseChunk(n.responseText)))},this._chunkError=function(h){h=n.statusText||h,this._sendError(new Error(h))}}function f(s){(s=s||{}).chunkSize||(s.chunkSize=l.LocalChunkSize),y.call(this,s);var n,h,d=typeof FileReader<"u";this.stream=function(c){this._input=c,h=c.slice||c.webkitSlice||c.mozSlice,d?((n=new FileReader).onload=it(this._chunkLoaded,this),n.onerror=it(this._chunkError,this)):n=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var c=this._input,_=(this._config.chunkSize&&(_=Math.min(this._start+this._config.chunkSize,this._input.size),c=h.call(c,this._start,_)),n.readAsText(c,this._config.encoding));d||this._chunkLoaded({target:{result:_}})},this._chunkLoaded=function(c){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(c.target.result)},this._chunkError=function(){this._sendError(n.error)}}function w(s){var n;y.call(this,s=s||{}),this.stream=function(h){return n=h,this._nextChunk()},this._nextChunk=function(){var h,d;if(!this._finished)return h=this._config.chunkSize,n=h?(d=n.substring(0,h),n.substring(h)):(d=n,""),this._finished=!n,this.parseChunk(d)}}function j(s){y.call(this,s=s||{});var n=[],h=!0,d=!1;this.pause=function(){y.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){y.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(c){this._input=c,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){d&&n.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),n.length?this.parseChunk(n.shift()):h=!0},this._streamData=it(function(c){try{n.push(typeof c=="string"?c:c.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(n.shift()))}catch(_){this._streamError(_)}},this),this._streamError=it(function(c){this._streamCleanUp(),this._sendError(c)},this),this._streamEnd=it(function(){this._streamCleanUp(),d=!0,this._streamData("")},this),this._streamCleanUp=it(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Z(s){var n,h,d,c,_=Math.pow(2,53),U=-_,N=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,q=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,T=this,M=0,m=0,Y=!1,b=!1,R=[],p={data:[],errors:[],meta:{}};function G(E){return s.skipEmptyLines==="greedy"?E.join("").trim()==="":E.length===1&&E[0].length===0}function H(){if(p&&d&&(Q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),d=!1),s.skipEmptyLines&&(p.data=p.data.filter(function(v){return!G(v)})),W()){let v=function(F,O){L(s.transformHeader)&&(F=s.transformHeader(F,O)),R.push(F)};if(p)if(Array.isArray(p.data[0])){for(var E=0;W()&&E<p.data.length;E++)p.data[E].forEach(v);p.data.splice(0,1)}else p.data.forEach(v)}function A(v,F){for(var O=s.header?{}:[],C=0;C<v.length;C++){var D=C,P=v[C],P=(($,x)=>(I=>(s.dynamicTypingFunction&&s.dynamicTyping[I]===void 0&&(s.dynamicTyping[I]=s.dynamicTypingFunction(I)),(s.dynamicTyping[I]||s.dynamicTyping)===!0))($)?x==="true"||x==="TRUE"||x!=="false"&&x!=="FALSE"&&((I=>{if(N.test(I)&&(I=parseFloat(I),U<I&&I<_))return 1})(x)?parseFloat(x):q.test(x)?new Date(x):x===""?null:x):x)(D=s.header?C>=R.length?"__parsed_extra":R[C]:D,P=s.transform?s.transform(P,D):P);D==="__parsed_extra"?(O[D]=O[D]||[],O[D].push(P)):O[D]=P}return s.header&&(C>R.length?Q("FieldMismatch","TooManyFields","Too many fields: expected "+R.length+" fields but parsed "+C,m+F):C<R.length&&Q("FieldMismatch","TooFewFields","Too few fields: expected "+R.length+" fields but parsed "+C,m+F)),O}var z;p&&(s.header||s.dynamicTyping||s.transform)&&(z=1,!p.data.length||Array.isArray(p.data[0])?(p.data=p.data.map(A),z=p.data.length):p.data=A(p.data,0),s.header&&p.meta&&(p.meta.fields=R),m+=z)}function W(){return s.header&&R.length===0}function Q(E,A,z,v){E={type:E,code:A,message:z},v!==void 0&&(E.row=v),p.errors.push(E)}L(s.step)&&(c=s.step,s.step=function(E){p=E,W()?H():(H(),p.data.length!==0&&(M+=E.data.length,s.preview&&M>s.preview?h.abort():(p.data=p.data[0],c(p,T))))}),this.parse=function(E,A,z){var v=s.quoteChar||'"',v=(s.newline||(s.newline=this.guessLineEndings(E,v)),d=!1,s.delimiter?L(s.delimiter)&&(s.delimiter=s.delimiter(E),p.meta.delimiter=s.delimiter):((v=((F,O,C,D,P)=>{var $,x,I,st;P=P||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var rt=0;rt<P.length;rt++){for(var K,ht=P[rt],X=0,J=0,B=0,V=(I=void 0,new dt({comments:D,delimiter:ht,newline:O,preview:10}).parse(F)),et=0;et<V.data.length;et++)C&&G(V.data[et])?B++:(K=V.data[et].length,J+=K,I===void 0?I=K:0<K&&(X+=Math.abs(K-I),I=K));0<V.data.length&&(J/=V.data.length-B),(x===void 0||X<=x)&&(st===void 0||st<J)&&1.99<J&&(x=X,$=ht,st=J)}return{successful:!!(s.delimiter=$),bestDelimiter:$}})(E,s.newline,s.skipEmptyLines,s.comments,s.delimitersToGuess)).successful?s.delimiter=v.bestDelimiter:(d=!0,s.delimiter=l.DefaultDelimiter),p.meta.delimiter=s.delimiter),ft(s));return s.preview&&s.header&&v.preview++,n=E,h=new dt(v),p=h.parse(n,A,z),H(),Y?{meta:{paused:!0}}:p||{meta:{paused:!1}}},this.paused=function(){return Y},this.pause=function(){Y=!0,h.abort(),n=L(s.chunk)?"":n.substring(h.getCharIndex())},this.resume=function(){T.streamer._halted?(Y=!1,T.streamer.parseChunk(n,!0)):setTimeout(T.resume,3)},this.aborted=function(){return b},this.abort=function(){b=!0,h.abort(),p.meta.aborted=!0,L(s.complete)&&s.complete(p),n=""},this.guessLineEndings=function(F,v){F=F.substring(0,1048576);var v=new RegExp(nt(v)+"([^]*?)"+nt(v),"gm"),z=(F=F.replace(v,"")).split("\r"),v=F.split(`
`),F=1<v.length&&v[0].length<z[0].length;if(z.length===1||F)return`
`;for(var O=0,C=0;C<z.length;C++)z[C][0]===`
`&&O++;return O>=z.length/2?`\r
`:"\r"}}function nt(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function dt(s){var n=(s=s||{}).delimiter,h=s.newline,d=s.comments,c=s.step,_=s.preview,U=s.fastMode,N=null,q=!1,T=s.quoteChar==null?'"':s.quoteChar,M=T;if(s.escapeChar!==void 0&&(M=s.escapeChar),(typeof n!="string"||-1<l.BAD_DELIMITERS.indexOf(n))&&(n=","),d===n)throw new Error("Comment character same as delimiter");d===!0?d="#":(typeof d!="string"||-1<l.BAD_DELIMITERS.indexOf(d))&&(d=!1),h!==`
`&&h!=="\r"&&h!==`\r
`&&(h=`
`);var m=0,Y=!1;this.parse=function(b,R,p){if(typeof b!="string")throw new Error("Input must be a string");var G=b.length,H=n.length,W=h.length,Q=d.length,E=L(c),A=[],z=[],v=[],F=m=0;if(!b)return X();if(U||U!==!1&&b.indexOf(T)===-1){for(var O=b.split(h),C=0;C<O.length;C++){if(v=O[C],m+=v.length,C!==O.length-1)m+=h.length;else if(p)return X();if(!d||v.substring(0,Q)!==d){if(E){if(A=[],st(v.split(n)),J(),Y)return X()}else st(v.split(n));if(_&&_<=C)return A=A.slice(0,_),X(!0)}}return X()}for(var D=b.indexOf(n,m),P=b.indexOf(h,m),$=new RegExp(nt(M)+nt(T),"g"),x=b.indexOf(T,m);;)if(b[m]===T)for(x=m,m++;;){if((x=b.indexOf(T,x+1))===-1)return p||z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:A.length,index:m}),K();if(x===G-1)return K(b.substring(m,x).replace($,T));if(T===M&&b[x+1]===M)x++;else if(T===M||x===0||b[x-1]!==M){D!==-1&&D<x+1&&(D=b.indexOf(n,x+1));var I=rt((P=P!==-1&&P<x+1?b.indexOf(h,x+1):P)===-1?D:Math.min(D,P));if(b.substr(x+1+I,H)===n){v.push(b.substring(m,x).replace($,T)),b[m=x+1+I+H]!==T&&(x=b.indexOf(T,m)),D=b.indexOf(n,m),P=b.indexOf(h,m);break}if(I=rt(P),b.substring(x+1+I,x+1+I+W)===h){if(v.push(b.substring(m,x).replace($,T)),ht(x+1+I+W),D=b.indexOf(n,m),x=b.indexOf(T,m),E&&(J(),Y))return X();if(_&&A.length>=_)return X(!0);break}z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:A.length,index:m}),x++}}else if(d&&v.length===0&&b.substring(m,m+Q)===d){if(P===-1)return X();m=P+W,P=b.indexOf(h,m),D=b.indexOf(n,m)}else if(D!==-1&&(D<P||P===-1))v.push(b.substring(m,D)),m=D+H,D=b.indexOf(n,m);else{if(P===-1)break;if(v.push(b.substring(m,P)),ht(P+W),E&&(J(),Y))return X();if(_&&A.length>=_)return X(!0)}return K();function st(B){A.push(B),F=m}function rt(B){var V=0;return V=B!==-1&&(B=b.substring(x+1,B))&&B.trim()===""?B.length:V}function K(B){return p||(B===void 0&&(B=b.substring(m)),v.push(B),m=G,st(v),E&&J()),X()}function ht(B){m=B,st(v),v=[],P=b.indexOf(h,m)}function X(B){if(s.header&&!R&&A.length&&!q){var V=A[0],et=Object.create(null),pt=new Set(V);let bt=!1;for(let at=0;at<V.length;at++){let tt=V[at];if(et[tt=L(s.transformHeader)?s.transformHeader(tt,at):tt]){let lt,xt=et[tt];for(;lt=tt+"_"+xt,xt++,pt.has(lt););pt.add(lt),V[at]=lt,et[tt]++,bt=!0,(N=N===null?{}:N)[lt]=tt}else et[tt]=1,V[at]=tt;pt.add(tt)}bt&&console.warn("Duplicate headers found and renamed."),q=!0}return{data:A,errors:z,meta:{delimiter:n,linebreak:h,aborted:Y,truncated:!!B,cursor:F+(R||0),renamedHeaders:N}}}function J(){c(X()),A=[],z=[]}},this.abort=function(){Y=!0},this.getCharIndex=function(){return m}}function Et(s){var n=s.data,h=u[n.workerId],d=!1;if(n.error)h.userError(n.error,n.file);else if(n.results&&n.results.data){var c={abort:function(){d=!0,mt(n.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:vt,resume:vt};if(L(h.userStep)){for(var _=0;_<n.results.data.length&&(h.userStep({data:n.results.data[_],errors:n.results.errors,meta:n.results.meta},c),!d);_++);delete n.results}else L(h.userChunk)&&(h.userChunk(n.results,c,n.file),delete n.results)}n.finished&&!d&&mt(n.workerId,n.results)}function mt(s,n){var h=u[s];L(h.userComplete)&&h.userComplete(n),h.terminate(),delete u[s]}function vt(){throw new Error("Not implemented.")}function ft(s){if(typeof s!="object"||s===null)return s;var n,h=Array.isArray(s)?[]:{};for(n in s)h[n]=ft(s[n]);return h}function it(s,n){return function(){s.apply(n,arguments)}}function L(s){return typeof s=="function"}return l.parse=function(s,n){var h=(n=n||{}).dynamicTyping||!1;if(L(h)&&(n.dynamicTypingFunction=h,h={}),n.dynamicTyping=h,n.transform=!!L(n.transform)&&n.transform,!n.worker||!l.WORKERS_SUPPORTED)return h=null,l.NODE_STREAM_INPUT,typeof s=="string"?(s=(d=>d.charCodeAt(0)!==65279?d:d.slice(1))(s),h=new(n.download?S:w)(n)):s.readable===!0&&L(s.read)&&L(s.on)?h=new j(n):(i.File&&s instanceof File||s instanceof Object)&&(h=new f(n)),h.stream(s);(h=(()=>{var d;return!!l.WORKERS_SUPPORTED&&(d=(()=>{var c=i.URL||i.webkitURL||null,_=e.toString();return l.BLOB_URL||(l.BLOB_URL=c.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",_,")();"],{type:"text/javascript"})))})(),(d=new i.Worker(d)).onmessage=Et,d.id=g++,u[d.id]=d)})()).userStep=n.step,h.userChunk=n.chunk,h.userComplete=n.complete,h.userError=n.error,n.step=L(n.step),n.chunk=L(n.chunk),n.complete=L(n.complete),n.error=L(n.error),delete n.worker,h.postMessage({input:s,config:n,workerId:h.id})},l.unparse=function(s,n){var h=!1,d=!0,c=",",_=`\r
`,U='"',N=U+U,q=!1,T=null,M=!1,m=((()=>{if(typeof n=="object"){if(typeof n.delimiter!="string"||l.BAD_DELIMITERS.filter(function(R){return n.delimiter.indexOf(R)!==-1}).length||(c=n.delimiter),typeof n.quotes!="boolean"&&typeof n.quotes!="function"&&!Array.isArray(n.quotes)||(h=n.quotes),typeof n.skipEmptyLines!="boolean"&&typeof n.skipEmptyLines!="string"||(q=n.skipEmptyLines),typeof n.newline=="string"&&(_=n.newline),typeof n.quoteChar=="string"&&(U=n.quoteChar),typeof n.header=="boolean"&&(d=n.header),Array.isArray(n.columns)){if(n.columns.length===0)throw new Error("Option columns is empty");T=n.columns}n.escapeChar!==void 0&&(N=n.escapeChar+U),n.escapeFormulae instanceof RegExp?M=n.escapeFormulae:typeof n.escapeFormulae=="boolean"&&n.escapeFormulae&&(M=/^[=+\-@\t\r].*$/)}})(),new RegExp(nt(U),"g"));if(typeof s=="string"&&(s=JSON.parse(s)),Array.isArray(s)){if(!s.length||Array.isArray(s[0]))return Y(null,s,q);if(typeof s[0]=="object")return Y(T||Object.keys(s[0]),s,q)}else if(typeof s=="object")return typeof s.data=="string"&&(s.data=JSON.parse(s.data)),Array.isArray(s.data)&&(s.fields||(s.fields=s.meta&&s.meta.fields||T),s.fields||(s.fields=Array.isArray(s.data[0])?s.fields:typeof s.data[0]=="object"?Object.keys(s.data[0]):[]),Array.isArray(s.data[0])||typeof s.data[0]=="object"||(s.data=[s.data])),Y(s.fields||[],s.data||[],q);throw new Error("Unable to serialize unrecognized input");function Y(R,p,G){var H="",W=(typeof R=="string"&&(R=JSON.parse(R)),typeof p=="string"&&(p=JSON.parse(p)),Array.isArray(R)&&0<R.length),Q=!Array.isArray(p[0]);if(W&&d){for(var E=0;E<R.length;E++)0<E&&(H+=c),H+=b(R[E],E);0<p.length&&(H+=_)}for(var A=0;A<p.length;A++){var z=(W?R:p[A]).length,v=!1,F=W?Object.keys(p[A]).length===0:p[A].length===0;if(G&&!W&&(v=G==="greedy"?p[A].join("").trim()==="":p[A].length===1&&p[A][0].length===0),G==="greedy"&&W){for(var O=[],C=0;C<z;C++){var D=Q?R[C]:C;O.push(p[A][D])}v=O.join("").trim()===""}if(!v){for(var P=0;P<z;P++){0<P&&!F&&(H+=c);var $=W&&Q?R[P]:P;H+=b(p[A][$],P)}A<p.length-1&&(!G||0<z&&!F)&&(H+=_)}}return H}function b(R,p){var G,H;return R==null?"":R.constructor===Date?JSON.stringify(R).slice(1,25):(H=!1,M&&typeof R=="string"&&M.test(R)&&(R="'"+R,H=!0),G=R.toString().replace(m,N),(H=H||h===!0||typeof h=="function"&&h(R,p)||Array.isArray(h)&&h[p]||((W,Q)=>{for(var E=0;E<Q.length;E++)if(-1<W.indexOf(Q[E]))return!0;return!1})(G,l.BAD_DELIMITERS)||-1<G.indexOf(c)||G.charAt(0)===" "||G.charAt(G.length-1)===" ")?U+G+U:G)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!a&&!!i.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=dt,l.ParserHandle=Z,l.NetworkStreamer=S,l.FileStreamer=f,l.StringStreamer=w,l.ReadableStreamStreamer=j,i.jQuery&&((r=i.jQuery).fn.parse=function(s){var n=s.config||{},h=[];return this.each(function(_){if(!(r(this).prop("tagName").toUpperCase()==="INPUT"&&r(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var U=0;U<this.files.length;U++)h.push({file:this.files[U],inputElem:this,instanceConfig:r.extend({},n)})}),d(),this;function d(){if(h.length===0)L(s.complete)&&s.complete();else{var _,U,N,q,T=h[0];if(L(s.before)){var M=s.before(T.file,T.inputElem);if(typeof M=="object"){if(M.action==="abort")return _="AbortError",U=T.file,N=T.inputElem,q=M.reason,void(L(s.error)&&s.error({name:_},U,N,q));if(M.action==="skip")return void c();typeof M.config=="object"&&(T.instanceConfig=r.extend(T.instanceConfig,M.config))}else if(M==="skip")return void c()}var m=T.instanceConfig.complete;T.instanceConfig.complete=function(Y){L(m)&&m(Y,T.file,T.inputElem),c()},l.parse(T.file,T.instanceConfig)}}function c(){h.splice(0,1),d()}}),o&&(i.onmessage=function(s){s=s.data,l.WORKER_ID===void 0&&s&&(l.WORKER_ID=s.workerId),typeof s.input=="string"?i.postMessage({workerId:l.WORKER_ID,results:l.parse(s.input,s.config),finished:!0}):(i.File&&s.input instanceof File||s.input instanceof Object)&&(s=l.parse(s.input,s.config))&&i.postMessage({workerId:l.WORKER_ID,results:s,finished:!0})}),(S.prototype=Object.create(y.prototype)).constructor=S,(f.prototype=Object.create(y.prototype)).constructor=f,(w.prototype=Object.create(w.prototype)).constructor=w,(j.prototype=Object.create(y.prototype)).constructor=j,l})})(ct)),ct.exports}var Mt=It();const zt=Lt(Mt),ut=class ut{async loadCSV(t,e){const i=t.split(","),r=i.length;let a=[];for(let o=0;o<r;o++){const u=await this.loadSingleCSV(i[o],g=>{e(Math.floor((o+g/100)/r*100))});a=a.concat(u)}return a}async loadSingleCSV(t,e){const i=await fetch(t),r=t.split("/").pop(),a=ut.FILE_SIZES[r],o=i.body.getReader();let u=0;const g=[];for(;;){const{done:S,value:f}=await o.read();if(S)break;g.push(f),a&&e&&(u+=f.length,e(u/a*100))}const y=await new Blob(g).text();return new Promise((S,f)=>{zt.parse(y,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:w=>{!w.data||w.data.length===0?f(new Error("CSV file contains no data")):S(w.data)},error:w=>f(w)})})}processData(t){const e=t.length,i=new Float32Array(e*2),r=new Float32Array(e),a=new Float32Array(e*4),o=new Array(e),u=new Array(e);let g=i[1]+r[0],l=i[0]+r[0],y=i[1]-r[0],S=i[0]-r[0];for(let f=0;f<e;f++){const w=t[f];i[f*2]=parseFloat(w.x),i[f*2+1]=parseFloat(w.y),r[f]=parseFloat(w.size),a[f*4]=parseFloat(w.r),a[f*4+1]=parseFloat(w.g),a[f*4+2]=parseFloat(w.b),a[f*4+3]=1,o[f]=w.title,u[f]=parseInt(w.id),g=Math.max(g,i[f*2+1]+r[f]),l=Math.max(l,i[f*2]+r[f]),y=Math.min(y,i[f*2+1]-r[f]),S=Math.min(S,i[f*2]-r[f])}return{numItems:e,offsets:i,sizes:r,colors:a,titles:o,ids:u,axisLimits:[S,y,l,g]}}};yt(ut,"FILE_SIZES",{"layout60k-Sep-10-2024.csv":6792224,"layout500k-Sep-10-2024.csv":57693366,"layout1m-part1-Sep-10-2024.csv":59988553,"layout1m-part2-Sep-10-2024.csv":56877942});let gt=ut;class Ft{constructor(t){this.bus=t,this.searchInput=document.getElementById("search"),this.resultsContainer=document.getElementById("search-results"),this.loadingIndicator=document.querySelector(".search-loading"),this.searchButton=document.getElementById("search-button"),this.isDataInitialized=!1,this.searchWorker=new Worker(new URL("/assets/searchworker-GZV8J5GI.js",import.meta.url),{type:"module"}),this.searchWorker.onmessage=e=>this.handleWorkerMessage(e),this.searchButton.addEventListener("click",()=>this.performSearch()),this.searchInput.addEventListener("input",()=>this.clearResults())}performSearch(){const t=this.searchInput.value.trim();if(!t){this.clearResults();return}this.loadingIndicator.style.display="block",this.searchWorker.postMessage({query:t,titles:this.isDataInitialized?null:this.bus.data.titles,options:{limit:5}}),this.isDataInitialized=!0}handleWorkerMessage(t){const{results:e}=t.data;this.displayResults(e),this.loadingIndicator.style.display="none"}displayResults(t){if(t.length===0){this.resultsContainer.innerHTML='<div class="search-result-empty">No results found</div>',this.resultsContainer.style.display="block";return}this.resultsContainer.innerHTML=t.map(e=>`<div class="search-result-item" data-title="${e.target}">${e.target}</div>`).join(""),this.resultsContainer.style.display="block",this.resultsContainer.querySelectorAll(".search-result-item").forEach(e=>{e.addEventListener("click",i=>this.handleResultClick(i))})}handleResultClick(t){const e=t.target.closest(".search-result-item").dataset.title;this.searchInput.value="",this.clearResults(),this.handleSearchResult(e)}handleSearchResult(t){const e=this.bus.data.titles.indexOf(t);if(e===-1)return;const i=this.bus.data.offsets[e*2],r=this.bus.data.offsets[e*2+1],a=this.bus.data.sizes[e]*5;this.bus.controls.smoothTransition(i,r,a,!0)}clearResults(){this.resultsContainer.innerHTML="",this.resultsContainer.style.display="none"}}class Ht{constructor(t){this.zoomLevel,this.cameraX=0,this.cameraY=0,this.isDragging=!1,this.wasDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.transitionActive=!1,this.startState=null,this.endState=null,this.midState=null,this.stageCount=0,this.stage=0,this.stage1Duration=2e3,this.stage2Duration=2e3,this.transitionStartTime=0,this.sensitivity=.002,this.lastTouchDistance=null,this.bus=t,this.lastAspectRatio=this.bus.webgl.canvas.width/this.bus.webgl.canvas.height,this.bus.webgl.canvas.addEventListener("mousedown",e=>this.handleMouseDown(e)),this.bus.webgl.canvas.addEventListener("touchstart",e=>this.handleTouchStart(e),{passive:!1}),this.bus.webgl.canvas.addEventListener("mouseup",()=>this.handleMouseUp()),this.bus.webgl.canvas.addEventListener("mouseleave",()=>this.handleMouseUp()),this.bus.webgl.canvas.addEventListener("touchend",()=>this.isDragging=!1),this.bus.webgl.canvas.addEventListener("mousemove",e=>this.handleMouseMove(e)),this.bus.webgl.canvas.addEventListener("touchmove",e=>this.handleTouchMove(e),{passive:!1}),this.bus.webgl.canvas.addEventListener("wheel",e=>this.handleZoom(e),{passive:!0}),this.bus.webgl.canvas.addEventListener("click",e=>{this.wasDragging||this.clickArticle(e),this.wasDragging=!1}),document.getElementById("random-button").addEventListener("click",()=>this.goToRandomArticle()),window.addEventListener("resize",()=>{this.bus.webgl.resizeCanvas();const e=this.bus.webgl.canvas.width/this.bus.webgl.canvas.height;(this.lastAspectRatio>1&&e<1||this.lastAspectRatio<1&&e>1)&&(this.cameraX=0,this.cameraY=0,this.zoomLevel=this.getMaxZoomLevel()),this.lastAspectRatio=e,this.zoomLevel=Math.min(this.zoomLevel,this.getMaxZoomLevel())}),document.getElementById("sensitivity-range").addEventListener("input",e=>{this.sensitivity=e.target.value/25e3,document.getElementById("sensitivity-value").textContent=e.target.value}),/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&(document.getElementById("sensitivity-container").style.display="none")}handleMouseDown(t){this.transitionActive||(this.isDragging=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY)}handleMouseUp(){this.isDragging=!1}handleMouseMove(t){!this.isDragging||this.transitionActive||(this.wasDragging=!0,this.updateCameraPosition(t.clientX,t.clientY))}handleTouchStart(t){this.transitionActive||(console.log("touch start"),t.preventDefault(),t.touches.length===2?this.lastTouchDistance=this.getTouchDistance(t.touches):t.touches.length===1&&(this.isDragging=!0,this.lastMouseX=t.touches[0].clientX,this.lastMouseY=t.touches[0].clientY))}handleTouchMove(t){if(!this.transitionActive)if(t.preventDefault(),t.touches.length===2){const e=this.getTouchDistance(t.touches),i=(t.touches[0].clientX+t.touches[1].clientX)/2,r=(t.touches[0].clientY+t.touches[1].clientY)/2,a=e/this.lastTouchDistance,o=this.screenToWorld(i,r);this.zoomLevel*=1/a,this.zoomLevel=Math.min(this.zoomLevel,this.getMaxZoomLevel()),this.zoomLevel=Math.max(this.zoomLevel,1e-7);const u=this.screenToWorld(i,r);this.cameraX+=o.x-u.x,this.cameraY+=o.y-u.y,this.lastTouchDistance=e}else t.touches.length===1&&this.isDragging&&this.updateCameraPosition(t.touches[0].clientX,t.touches[0].clientY)}getTouchDistance(t){const e=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.hypot(e,i)}handleZoom(t){if(this.transitionActive)return;const e=Math.exp(t.deltaY*this.sensitivity),i=this.screenToWorld(t.clientX,t.clientY);this.zoomLevel*=e,this.zoomLevel=Math.min(this.zoomLevel,this.getMaxZoomLevel()),this.zoomLevel=Math.max(this.zoomLevel,1e-7);const r=this.screenToWorld(t.clientX,t.clientY);this.cameraX+=i.x-r.x,this.cameraY+=i.y-r.y}screenToWorld(t,e){const i=this.bus.webgl.canvas.getBoundingClientRect(),r=(t-i.left)/i.width,a=(e-i.top)/i.height,o=r*2-1,u=-(a*2-1),g=this.zoomLevel*this.bus.webgl.canvas.width/this.bus.webgl.canvas.height,l=this.zoomLevel,y=this.cameraX+o*g/2,S=this.cameraY+u*l/2;return{x:y,y:S}}getMaxZoomLevel(){if(!this.bus.data)return;const[t,e,i,r]=this.bus.data.axisLimits,a=i-t,o=r-e,u=this.bus.webgl.canvas,g=u.width/u.height,l=a/g;return Math.max(l,o)*1.1}updateCameraPosition(t,e){const i=this.screenToWorld(this.lastMouseX,this.lastMouseY),r=this.screenToWorld(t,e);this.cameraX+=i.x-r.x,this.cameraY+=i.y-r.y,this.lastMouseX=t,this.lastMouseY=e}smoothTransition(t,e,i,r){if(this.transitionActive=!0,this.startState={x:this.cameraX,y:this.cameraY,zoom:this.zoomLevel},this.endState={x:t,y:e,zoom:i},this.stage1Duration=2e3,this.stage2Duration=2e3,r===!1)this.stageCount=1;else{const a=this.endState.x-this.startState.x,o=this.endState.y-this.startState.y,u=Math.hypot(a,o),g=Math.max(this.startState.zoom,u);this.midState={x:this.cameraX,y:this.cameraY,zoom:g},this.stageCount=2,this.stage=0,this.zoomLevel===g&&(this.stage1Duration=0)}this.transitionStartTime=performance.now()}updateTransition(t){const e=t-this.transitionStartTime;let i;this.stageCount===1?i=this.stage1Duration:this.stage===0?i=this.stage1Duration:i=this.stage2Duration;const r=Math.min(e/i,1),a=r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2;if(this.stageCount===1)this.zoomLevel=this.startState.zoom+(this.endState.zoom-this.startState.zoom)*a,r>=1&&(this.cameraX=this.endState.x,this.cameraY=this.endState.y,this.transitionActive=!1);else if(this.stageCount===2&&this.stage===0)this.zoomLevel=this.startState.zoom+(this.midState.zoom-this.startState.zoom)*a,r>=1&&(this.stage=1,this.transitionStartTime=t);else if(this.stageCount===2&&this.stage===1){const o=this.midState,u=this.endState;this.cameraX=o.x+(u.x-o.x)*a,this.cameraY=o.y+(u.y-o.y)*a,this.zoomLevel=o.zoom+(u.zoom-o.zoom)*a,r>=1&&(this.transitionActive=!1)}}reset(){this.cameraX=0,this.cameraY=0,this.zoomLevel=0,this.smoothTransition(0,0,this.getMaxZoomLevel(),!1)}clickArticle(t){const e=this.screenToWorld(t.clientX,t.clientY);console.log("cursor",e);const{offsets:i,sizes:r,ids:a,titles:o,numItems:u}=this.bus.data;for(let g=0;g<u;g++){const l=i[g*2],y=i[g*2+1],S=r[g],f=e.x-l,w=e.y-y;if(Math.sqrt(f*f+w*w)<=S){const Z=a[g],nt=o[g];console.log(l,y,S),console.log(`Clicked on article: ${nt} (ID: ${Z})`),this.showEmbeddedWikiArticle(Z);return}}}showEmbeddedWikiArticle(t){const e=document.getElementById("wiki-embed-container"),i=document.getElementById("wiki-iframe"),r=document.getElementById("close-wiki-btn"),a=`https://en.wikipedia.org/?curid=${t}`;i.src=a,e.classList.add("active"),this._outsideClickHandler||(this._outsideClickHandler=o=>{!e.contains(o.target)&&e.classList.contains("active")&&!o.target.closest("#webgl-canvas")&&r.click()}),r.onclick=()=>{e.classList.remove("active"),document.removeEventListener("click",this._outsideClickHandler),setTimeout(()=>{i.src="about:blank"},300)},document.addEventListener("click",this._outsideClickHandler)}goToRandomArticle(){const t=Math.floor(Math.random()*this.bus.data.numItems),e=this.bus.data.offsets[t*2],i=this.bus.data.offsets[t*2+1],r=this.bus.data.sizes[t]*5;this.smoothTransition(e,i,r,!0)}}class wt{constructor(t,e,i){this.id=0,this.name=t,this.fg=e,this.bg=i,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px;background-color: transparent !important;",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const t=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let e;const i=this.fg;switch(this.fg.toLowerCase()){case"#0ff":e="#006666";break;case"#0f0":e="#006600";break;case"#ff0":e="#666600";break;case"#e1e1e1":e="#666666";break;default:e=this.bg;break}return t.addColorStop(0,e),t.addColorStop(1,i),t}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(t,e,i=0){if(!this.context||!this.gradient)return;const r=Math.min(1/0,t),a=Math.max(e,t);this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${t.toFixed(i)} ${this.name} (${r.toFixed(i)}-${parseFloat(a.toFixed(i))})`,this.TEXT_X,this.TEXT_Y)}updateGraph(t,e){if(!this.context||!this.gradient)return;t===0&&e===0&&(e=1),e=Math.max(e,t,.1),t=Math.max(t,0);const i=Math.round(this.GRAPH_X),r=Math.round(this.GRAPH_Y),a=Math.round(this.GRAPH_WIDTH),o=Math.round(this.GRAPH_HEIGHT),u=Math.round(this.PR);this.context.drawImage(this.canvas,i+u,r,a-u,o,i,r,a-u,o),this.context.fillStyle=this.bg,this.context.fillRect(i+a-u,r,u,o);const g=Math.min(o,Math.round(t/e*o));g>0&&(this.context.globalAlpha=.9,this.context.fillStyle=this.gradient,this.context.fillRect(i+a-u,r+(o-g),u,g)),this.context.globalAlpha=1}}class Ut extends wt{constructor(t,e,i){super(t,e,i),this.vsyncValue=0,this.SMALL_HEIGHT=9*this.PR,this.HEIGHT=this.SMALL_HEIGHT,this.WIDTH=35*this.PR,this.TEXT_Y=0*this.PR,this.canvas.height=this.HEIGHT,this.canvas.width=this.WIDTH,this.canvas.style.height="9px",this.canvas.style.width="35px",this.canvas.style.cssText=`
            width: 35px;
            height: 9px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent !important;
            pointer-events: none;
        `,this.initializeCanvas()}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.globalAlpha=1)}update(t,e,i=0){this.context&&(this.vsyncValue=t,this.context.clearRect(0,0,this.WIDTH,this.HEIGHT),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillText(`${t.toFixed(0)}Hz`,this.TEXT_X,this.TEXT_Y))}updateGraph(t,e){}setOffset(t,e){this.canvas.style.transform=`translate(${t}px, ${e}px)`}}const Rt=class ot{constructor({trackGPU:t=!1,trackCPT:e=!1,trackHz:i=!1,logsPerSecond:r=4,graphsPerSecond:a=30,samplesLog:o=40,samplesGraph:u=10,precision:g=2,minimal:l=!1,horizontal:y=!0,mode:S=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.vsyncPanel=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.updateCounter=0,this.lastMin={},this.lastMax={},this.lastValue={},this.VSYNC_RATES=[{refreshRate:60,frameTime:16.67},{refreshRate:75,frameTime:13.33},{refreshRate:90,frameTime:11.11},{refreshRate:120,frameTime:8.33},{refreshRate:144,frameTime:6.94},{refreshRate:165,frameTime:6.06},{refreshRate:240,frameTime:4.17}],this.detectedVSync=null,this.frameTimeHistory=[],this.HISTORY_SIZE=120,this.VSYNC_THRESHOLD=.05,this.lastFrameTime=0,this.handleClick=w=>{w.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel),this.resizePanel(this.msPanel),this.gpuPanel&&this.resizePanel(this.gpuPanel),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute)},this.mode=S,this.horizontal=y,this.minimal=l,this.trackGPU=t,this.trackCPT=e,this.trackHz=i,this.samplesLog=o,this.samplesGraph=u,this.precision=g,this.logsPerSecond=r,this.graphsPerSecond=a;const f=performance.now();this.prevGraphTime=f,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTextTime=this.beginTime,this.prevCpuTime=this.beginTime,this._panelId=0,this.fpsPanel=this.addPanel(new ot.Panel("FPS","#0ff","#002")),this.msPanel=this.addPanel(new ot.Panel("CPU","#0f0","#020")),this.trackHz===!0&&(this.vsyncPanel=new Ut("","#f0f","#202"),this.dom.appendChild(this.vsyncPanel.canvas),this.vsyncPanel.setOffset(56,35)),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(t){if(!t){console.error('Stats: The "canvas" parameter is undefined.');return}if(!this.handleThreeRenderer(t)&&!await this.handleWebGPURenderer(t))if(this.initializeWebGL(t)){this.trackGPU&&this.initializeGPUTracking();return}else console.error("Stats-gl: Failed to initialize WebGL context")}handleThreeRenderer(t){return t.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(t),this.gl=t.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(t){return t.isWebGPURenderer?((this.trackGPU||this.trackCPT)&&(t.backend.trackTimestamp=!0,await t.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=t.info,this.patchThreeWebGPU(t),!0):!1}initializeWebGPUPanels(){this.trackGPU&&(this.gpuPanel=this.addPanel(new ot.Panel("GPU","#ff0","#220"))),this.trackCPT&&(this.gpuPanelCompute=this.addPanel(new ot.Panel("CPT","#e1e1e1","#212121")))}initializeWebGL(t){if(t instanceof WebGL2RenderingContext)this.gl=t;else if(t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas){if(this.gl=t.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new ot.Panel("GPU","#ff0","#220"))))}begin(){this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=this.endInternal()}resizePanel(t){t.canvas.style.position="absolute",this.minimal?t.canvas.style.display="none":(t.canvas.style.display="block",this.horizontal?(t.canvas.style.top="0px",t.canvas.style.left=t.id*t.WIDTH/t.PR+"px"):(t.canvas.style.left="0px",t.canvas.style.top=t.id*t.HEIGHT/t.PR+"px"))}addPanel(t){return t.canvas&&(this.dom.appendChild(t.canvas),t.id=this._panelId,this.resizePanel(t),this._panelId++),t}showPanel(t){for(let e=0;e<this.dom.children.length;e++){const i=this.dom.children[e];i.style.display=e===t?"block":"none"}this.mode=t}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((t,e)=>{if(this.gl){const i=this.gl.getQueryParameter(t.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(i&&!r){const o=this.gl.getQueryParameter(t.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(t.query),this.gpuQueries.splice(e,1)}}}))}detectVSync(t){if(this.lastFrameTime===0){this.lastFrameTime=t;return}const e=t-this.lastFrameTime;if(this.lastFrameTime=t,this.frameTimeHistory.push(e),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length<60)return;const i=this.frameTimeHistory.reduce((g,l)=>g+l)/this.frameTimeHistory.length,r=this.frameTimeHistory.reduce((g,l)=>g+Math.pow(l-i,2),0)/this.frameTimeHistory.length;if(Math.sqrt(r)>2){this.detectedVSync=null;return}let o=null,u=1/0;for(const g of this.VSYNC_RATES){const l=Math.abs(i-g.frameTime);l<u&&(u=l,o=g)}o&&u/o.frameTime<=this.VSYNC_THRESHOLD?this.detectedVSync=o:this.detectedVSync=null}endInternal(){var t;const e=performance.now();for(this.frameTimes.push(e);this.frameTimes.length>0&&this.frameTimes[0]<=e-1e3;)this.frameTimes.shift();const i=Math.round(this.frameTimes.length);this.addToAverage(i,this.averageFps);const r=e>=this.prevTextTime+1e3/this.logsPerSecond,a=e>=this.prevGraphTime+1e3/this.graphsPerSecond;if(this.updatePanelComponents(this.fpsPanel,this.averageFps,0,r,a),this.updatePanelComponents(this.msPanel,this.averageCpu,this.precision,r,a),this.gpuPanel&&this.updatePanelComponents(this.gpuPanel,this.averageGpu,this.precision,r,a),this.trackCPT&&this.gpuPanelCompute&&this.updatePanelComponents(this.gpuPanelCompute,this.averageGpuCompute,this.precision,r,a),r&&(this.prevTextTime=e),a&&(this.prevGraphTime=e),this.vsyncPanel!==null){this.detectVSync(e);const o=((t=this.detectedVSync)==null?void 0:t.refreshRate)||0;r&&o>0&&this.vsyncPanel.update(o,o)}return e}updatePanelComponents(t,e,i,r,a){if(!t||e.logs.length===0)return;t.name in this.lastMin||(this.lastMin[t.name]=1/0,this.lastMax[t.name]=0,this.lastValue[t.name]=0);const o=e.logs[e.logs.length-1];this.lastMax[t.name]=Math.max(...e.logs),this.lastMin[t.name]=Math.min(this.lastMin[t.name],o),this.lastValue[t.name]=this.lastValue[t.name]*.7+o*.3;const u=Math.max(Math.max(...e.logs),...e.graph.slice(-this.samplesGraph));this.updateCounter++,r&&t.update(this.lastValue[t.name],this.lastMax[t.name],i),a&&t.updateGraph(o,u)}beginProfiling(t){if(window.performance)try{window.performance.clearMarks(t),window.performance.mark(t)}catch(e){console.debug("Stats: Performance marking failed:",e)}}endProfiling(t,e,i){if(!(!window.performance||!e||!t))try{window.performance.getEntriesByName(t,"mark").length===0&&this.beginProfiling(t),window.performance.clearMarks(e),window.performance.mark(e),window.performance.clearMeasures(i);const a=performance.measure(i,t,e);this.totalCpuDuration+=a.duration,window.performance.clearMarks(t),window.performance.clearMarks(e),window.performance.clearMeasures(i)}catch(r){console.debug("Stats: Performance measurement failed:",r)}}updatePanel(t,e,i=2){if(!t||e.logs.length===0)return;const r=performance.now();t.name in this.lastMin||(this.lastMin[t.name]=1/0,this.lastMax[t.name]=0,this.lastValue[t.name]=0);const a=e.logs[e.logs.length-1],o=Math.max(...e.logs.slice(-30));this.lastMin[t.name]=Math.min(this.lastMin[t.name],a),this.lastMax[t.name]=Math.max(this.lastMax[t.name],a),this.lastValue[t.name]=this.lastValue[t.name]*.7+a*.3;const u=Math.max(o,...e.graph.slice(-this.samplesGraph));this.updateCounter++,this.updateCounter%(this.logsPerSecond*2)===0&&(this.lastMax[t.name]=o,this.lastMin[t.name]=a),t.update&&(r>=this.prevCpuTime+1e3/this.logsPerSecond&&t.update(this.lastValue[t.name],a,this.lastMax[t.name],u,i),r>=this.prevGraphTime+1e3/this.graphsPerSecond&&(t.updateGraph(a,u),this.prevGraphTime=r))}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&this.totalGpuDurationCompute!==void 0&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(t,e){e.logs.push(t),e.logs.length>this.samplesLog&&(e.logs=e.logs.slice(-this.samplesLog)),e.graph.push(t),e.graph.length>this.samplesGraph&&(e.graph=e.graph.slice(-this.samplesGraph))}get domElement(){return this.dom}patchThreeWebGPU(t){const e=t.info.reset,i=this;t.info.reset=function(){i.beginProfiling("cpu-started"),e.call(this)}}patchThreeRenderer(t){const e=t.render,i=this;t.render=function(r,a){i.begin(),e.call(this,r,a),i.end()},this.threeRendererPatched=!0}};Rt.Panel=wt;let Gt=Rt;class Ot{constructor(t){this.bus=t,this.animationFrameId=null,this.initializing=!1,this.lastTextUpdateTime=0,this.textUpdateInterval=1e3,this.pctEl=document.getElementById("loading-percent"),this.stats=new Gt({trackGPU:!1,trackHz:!1,trackCPT:!1,logsPerSecond:4,graphsPerSecond:30,samplesLog:40,samplesGraph:10,precision:2,horizontal:!0,minimal:!1,mode:0}),this.stats.dom.style.position="fixed",this.stats.dom.style.bottom="45px",this.stats.dom.style.right="180px",this.stats.dom.style.top="auto",this.stats.dom.style.left="auto",document.body.appendChild(this.stats.dom),document.getElementById("load-button").addEventListener("click",()=>this.initialize()),this.setupIntroOverlay()}setupIntroOverlay(){const t=document.getElementById("intro-overlay"),e=document.getElementById("start-exploration"),i=document.getElementById("csv-select");e.addEventListener("click",()=>{const r=document.querySelector('input[name="dataset"]:checked').value;i.value=r,t.style.display="none",this.initialize()})}async initialize(){if(this.initializing)return;this.initializing=!0;const e=document.getElementById("csv-select").value,i=document.getElementById("loading");i.style.display="flex";const r=await this.bus.dataLoader.loadCSV(e,a=>{this.pctEl.textContent=`${Math.floor(a)}%`});console.log(`Loaded ${r.length} data points from CSV`),this.bus.data=this.bus.dataLoader.processData(r),this.bus.circleRenderer.batchAddCircles(this.bus.data),await this.bus.textRenderer.loadFont(),this.updateVisibleText(),this.bus.searchManager.isDataInitialized=!1,this.bus.controls.reset(),this.animationFrameId||(this.animationFrameId=requestAnimationFrame(a=>this.draw(a))),i.style.display="none",this.initializing=!1}updateVisibleText(){const t=this.bus.controls.screenToWorld(0,0),e=this.bus.controls.screenToWorld(this.bus.webgl.canvas.width,this.bus.webgl.canvas.height),i={minX:Math.min(t.x,e.x),maxX:Math.max(t.x,e.x),minY:Math.min(t.y,e.y),maxY:Math.max(t.y,e.y)};if((i.maxX-i.minX)*(i.maxY-i.minY)>3e3)return;const a=[],{offsets:o,sizes:u,titles:g,numItems:l}=this.bus.data;for(let f=0;f<l;f++){const w=o[f*2],j=o[f*2+1];w>=i.minX&&w<=i.maxX&&j>=i.minY&&j<=i.maxY&&a.push({text:g[f],x:w,y:j,limit:2*u[f],cx:.51,cy:.5,radius:u[f]})}const y=1e3;let S=a;a.length>y&&(S=a.sort((f,w)=>w.radius-f.radius).slice(0,y)),console.log(`Showing ${S.length} labels out of ${a.length} visible circles`),this.bus.textRenderer.batchAddText(S)}draw(t){this.stats.begin(),this.bus.webgl.clear(),this.bus.webgl.resizeCanvas(),this.bus.controls.transitionActive&&this.bus.controls.updateTransition(t),t-this.lastTextUpdateTime>this.textUpdateInterval&&(this.updateVisibleText(),this.lastTextUpdateTime=t);const e=this.bus.webgl.createProjectionMatrix(this.bus.controls.cameraX,this.bus.controls.cameraY,this.bus.controls.zoomLevel);this.bus.circleRenderer.draw(e,this.bus.controls.zoomLevel*3e-4),this.bus.textRenderer.draw(e),this.animationFrameId=requestAnimationFrame(i=>this.draw(i)),this.stats.end(),this.stats.update()}}class Bt{constructor(){this.data,this.visualization=new Ot(this),this.webgl=new St,this.textRenderer=new kt(this),this.circleRenderer=new Ct(this),this.controls=new Ht(this),this.searchManager=new Ft(this),this.dataLoader=new gt}}try{new Bt}catch(k){console.error(k),alert("Failed to initialize the application. See console for details.")}
